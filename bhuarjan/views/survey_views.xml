<?xml version="1.0" encoding="utf-8"?>
<odoo>
    <!-- Survey List View -->
    <record id="view_bhu_survey_list" model="ir.ui.view">
        <field name="name">bhu.survey.list</field>
        <field name="model">bhu.survey</field>
        <field name="arch" type="xml">
            <list string="Surveys / सर्वे" decoration-info="state == 'draft'" decoration-success="state == 'approved'" decoration-danger="state == 'rejected'" decoration-muted="state == 'locked'">
                <field name="name"/>
                <field name="project_id"/>
                <field name="department_id"/>
                <field name="village_id"/>
                <field name="tehsil_id"/>
                <field name="khasra_number"/>
                <field name="total_area"/>
                <field name="acquired_area"/>
                <field name="survey_date"/>
                <field name="state" widget="badge"/>
            </list>
        </field>
    </record>

    <!-- Survey Form View -->
    <record id="view_bhu_survey_form" model="ir.ui.view">
        <field name="name">bhu.survey.form</field>
        <field name="model">bhu.survey</field>
        <field name="arch" type="xml">
            <form string="Survey / सर्वे">
                <header>
                    <button name="action_submit" string="Submit / प्रस्तुत करें" type="object" class="btn-primary" invisible="state != 'draft'"/>
                    <button name="action_approve" string="Approve / अनुमोदित करें" type="object" class="btn-success" invisible="state != 'submitted'"/>
                    <button name="action_reject" string="Reject / अस्वीकृत करें" type="object" class="btn-danger" invisible="state != 'submitted'"/>
                    <button name="action_reset_to_draft" string="Reset to Draft / प्रारूप में रीसेट" type="object" invisible="state != 'rejected'"/>
                    <button name="action_download_form10" string="Download Form-10 / फार्म-10 डाउनलोड करें" type="object" class="btn-info" icon="fa-download"/>
                    <button name="action_capture_location" string="Capture Location / स्थान कैप्चर करें" type="object" class="btn-secondary" icon="fa-map-marker"/>
                    <field name="state" widget="statusbar" statusbar_visible="draft,submitted,approved,locked"/>
                </header>
                <sheet>
                    <div class="oe_title">
                        <h1>
                            <field name="name" placeholder="Survey Number / सर्वे नंबर"/>
                        </h1>
                    </div>
                    
                    <!-- Locked Survey Warning -->
                    <div class="alert alert-warning" role="alert" invisible="state != 'locked'">
                        <strong>Survey Locked / सर्वे लॉक:</strong> This survey has been used to generate Notification 4 and is now locked. No further modifications are allowed.
                        <br/>
                        <strong>सर्वे लॉक:</strong> इस सर्वे का उपयोग अधिसूचना 4 जेनरेट करने के लिए किया गया है और अब यह लॉक है। कोई और संशोधन की अनुमति नहीं है।
                    </div>
                    
                    <group>
                        <group string="Project Information / परियोजना की जानकारी">
                            <field name="project_id" widget="selection" readonly="state == 'locked'"/>
                            <field name="department_id" widget="selection" readonly="state == 'locked'"/>
                            <field name="survey_date" widget="date" readonly="state == 'locked'"/>
                        </group>
                        <group string="Location Information / स्थान की जानकारी">
                            <field name="village_id" widget="selection" readonly="state == 'locked'"/>
                            <field name="tehsil_id" widget="selection" readonly="state == 'locked'"/>
                            <field name="district_name" readonly="state == 'locked'"/>
                        </group>
                    </group>
                    
                    <group>
                        <group>
                            <field name="survey_uuid" readonly="1"/>
                        </group>
                    </group>
                    
                    <group string="Landowners / भूमिस्वामी">
                        <field name="landowner_ids" widget="many2many_tags" options="{'no_create': False, 'no_create_edit': False}"/>
                    </group>
                    
                    <notebook>
                        <page string="Landowners / भूमिस्वामी" name="landowners_details">
                            <field name="landowner_ids" readonly="1">
                                <list string="Landowner Details / भूमिस्वामी विवरण" decoration-info="is_minor">
                                    <field name="name" string="Name / नाम"/>
                                    <field name="father_name" string="Father's Name / पिता का नाम"/>
                                    <field name="age" string="Age / आयु"/>
                                    <field name="gender" string="Gender / लिंग"/>
                                    <field name="mobile" string="Mobile / मोबाइल"/>
                                    <field name="email" string="Email / ईमेल"/>
                                    <field name="village_id" string="Village / ग्राम"/>
                                    <field name="tehsil_id" string="Tehsil / तहसील"/>
                                    <field name="district_id" string="District / जिला"/>
                                    <field name="aadhar_number" string="Aadhar / आधार"/>
                                    <field name="pan_number" string="PAN / पैन"/>
                                    <field name="bank_name" string="Bank / बैंक"/>
                                    <field name="account_number" string="Account / खाता"/>
                                    <field name="is_minor" string="Minor / नाबालिग"/>
                                </list>
                            </field>
                        </page>
                        
                        <page string="Khasra Details / खसरा विवरण" name="khasra_details">
                            <group>
                                <group string="Land Information / भूमि की जानकारी">
                                    <field name="khasra_number" widget="char" readonly="state == 'locked'"/>
                                    <field name="total_area" widget="float" readonly="state == 'locked'"/>
                                    <field name="acquired_area" widget="float" readonly="state == 'locked'"/>
                                </group>
                                <group string="Crop Information / फसल की जानकारी">
                                    <field name="is_single_crop" widget="boolean_toggle" readonly="state == 'locked'"/>
                                    <field name="is_double_crop" widget="boolean_toggle" readonly="state == 'locked'"/>
                                    <field name="is_irrigated" widget="boolean_toggle" readonly="state == 'locked'"/>
                                    <field name="is_unirrigated" widget="boolean_toggle" readonly="state == 'locked'"/>
                                </group>
                            </group>
                            
                            <group>
                                <group string="Tree Information / वृक्ष की जानकारी">
                                    <field name="tree_development_stage" widget="selection" readonly="state == 'locked'"/>
                                    <field name="tree_count" widget="integer" readonly="state == 'locked'"/>
                                </group>
                                <group string="House Information / घर की जानकारी">
                                    <field name="house_type" widget="selection" readonly="state == 'locked'"/>
                                    <field name="house_area" widget="float" readonly="state == 'locked'"/>
                                    <field name="shed_area" widget="float" readonly="state == 'locked'"/>
                                </group>
                            </group>
                            
                            <group>
                                <group string="Infrastructure / बुनियादी सुविधाएं">
                                    <field name="has_well" widget="boolean_toggle" readonly="state == 'locked'"/>
                                    <field name="well_type" widget="selection" invisible="not has_well" readonly="state == 'locked'"/>
                                    <field name="has_electricity" widget="boolean_toggle" readonly="state == 'locked'"/>
                                    <field name="has_road_access" widget="boolean_toggle" readonly="state == 'locked'"/>
                                    <field name="has_tubewell" widget="boolean_toggle" readonly="state == 'locked'"/>
                                    <field name="has_pond" widget="boolean_toggle" readonly="state == 'locked'"/>
                                </group>
                            </group>
                        </page>
                        
                        <page string="Survey Evidence / सर्वे साक्ष्य" name="survey_evidence">
                            <group>
                                <group string="Survey Image / सर्वे छवि">
                                    <field name="survey_image" widget="image" class="oe_avatar"/>
                                    <field name="survey_image_filename" invisible="1"/>
                                </group>
                                <group string="Location Information / स्थान की जानकारी">
                                    <field name="latitude" widget="float"/>
                                    <field name="longitude" widget="float"/>
                                    <field name="location_accuracy" widget="float"/>
                                    <field name="location_timestamp" widget="datetime"/>
                                </group>
                            </group>
                            
                            <!-- GPS Capture Script - External File -->
                            <script type="text/javascript" src="/bhuarjan/static/src/js/survey_gps_capture.js"></script>
                        </page>
                        
                        <page string="Attachments / संलग्नक" name="attachments">
                            <field name="attachment_ids" widget="many2many_binary"/>
                        </page>
                    </notebook>
                    
                    <!-- Chatter removed -->
                </sheet>
            </form>
        </field>
    </record>

    <!-- Survey Search View -->
    <record id="view_bhu_survey_search" model="ir.ui.view">
        <field name="name">bhu.survey.search</field>
        <field name="model">bhu.survey</field>
        <field name="arch" type="xml">
            <search string="Search Surveys / सर्वे खोजें">
                <field name="name"/>
                <field name="project_id"/>
                <field name="department_id"/>
                <field name="village_id"/>
                <field name="tehsil_id"/>
                <field name="khasra_number"/>
                <field name="survey_date"/>
                <field name="survey_uuid"/>
                
                <filter string="Draft / प्रारूप" name="draft" domain="[('state', '=', 'draft')]"/>
                <filter string="Submitted / प्रस्तुत" name="submitted" domain="[('state', '=', 'submitted')]"/>
                <filter string="Approved / अनुमोदित" name="approved" domain="[('state', '=', 'approved')]"/>
                <filter string="Rejected / अस्वीकृत" name="rejected" domain="[('state', '=', 'rejected')]"/>
                
                <separator/>
                <filter string="This Month / इस महीने" name="this_month" domain="[('survey_date', '>=', (context_today() - relativedelta(months=1)).strftime('%Y-%m-01')), ('survey_date', '&lt;', (context_today() + relativedelta(months=1)).strftime('%Y-%m-01'))]"/>
                <filter string="This Year / इस साल" name="this_year" domain="[('survey_date', '>=', context_today().strftime('%Y-01-01')), ('survey_date', '&lt;', (context_today() + relativedelta(years=1)).strftime('%Y-01-01'))]"/>
                
                <group expand="0" string="Group By / समूह बनाएं">
                    <filter string="State / स्थिति" name="group_state" context="{'group_by': 'state'}"/>
                    <filter string="Village / ग्राम" name="group_village" context="{'group_by': 'village_id'}"/>
                    <filter string="Tehsil / तहसील" name="group_tehsil" context="{'group_by': 'tehsil_id'}"/>
                    <filter string="Khasra Number / खसरा नंबर" name="group_khasra" context="{'group_by': 'khasra_number'}"/>
                    <filter string="Project / परियोजना" name="group_project" context="{'group_by': 'project_id'}"/>
                    <filter string="Department / विभाग" name="group_department" context="{'group_by': 'department_id'}"/>
                    <filter string="Survey Date / सर्वे दिनाँक" name="group_survey_date" context="{'group_by': 'survey_date'}"/>
                </group>
            </search>
        </field>
    </record>

    <!-- Survey Action -->
    <record id="action_bhu_survey" model="ir.actions.act_window">
        <field name="name">Surveys / सर्वे</field>
        <field name="res_model">bhu.survey</field>
        <field name="view_mode">list,form</field>
        <field name="search_view_id" ref="view_bhu_survey_search"/>
        <field name="context">{'search_default_this_year': 1}</field>
        <field name="help" type="html">
            <p class="o_view_nocontent_smiling_face">
                Create your first Survey!
            </p>
            <p>
                Survey is used for preliminary land acquisition surveys.
                You can add multiple citizens/landowners in one survey.
            </p>
        </field>
    </record>

    <!-- Bulk Download Form-10 Action -->
    <record id="action_bulk_download_form10" model="ir.actions.server">
        <field name="name">Download Form-10 PDFs / फार्म-10 PDF डाउनलोड करें</field>
        <field name="model_id" ref="model_bhu_survey"/>
        <field name="binding_model_id" ref="model_bhu_survey"/>
        <field name="state">code</field>
        <field name="code">
if records:
    action = records.action_bulk_download_form10()
</field>
    </record>

    <!-- Survey Kanban View -->
    <record id="view_bhu_survey_kanban" model="ir.ui.view">
        <field name="name">bhu.survey.kanban</field>
        <field name="model">bhu.survey</field>
        <field name="arch" type="xml">
            <kanban string="Surveys / सर्वे" class="o_kanban_small_column">
                <field name="name"/>
                <field name="project_id"/>
                <field name="village_id"/>
                <field name="state"/>
                <field name="survey_date"/>
                <templates>
                    <t t-name="kanban-box">
                        <div class="oe_kanban_card oe_kanban_global_click">
                            <div class="oe_kanban_content">
                                <div class="o_kanban_record_top">
                                    <div class="o_kanban_record_headings">
                                        <strong class="o_kanban_record_title">
                                            <field name="name"/>
                                        </strong>
                                        <br/>
                                        <span class="o_kanban_record_subtitle">
                                            <field name="project_id"/>
                                        </span>
                                    </div>
                                    <div class="o_dropdown_kanban dropdown">
                                        <a class="dropdown-toggle o-no-caret btn" role="button" data-toggle="dropdown" href="#" aria-label="Dropdown menu" title="Dropdown menu">
                                            <span class="fa fa-ellipsis-v"/>
                                        </a>
                                        <div class="dropdown-menu" role="menu">
                                            <a role="menuitem" type="edit" class="dropdown-item">Edit</a>
                                            <a role="menuitem" type="delete" class="dropdown-item">Delete</a>
                                        </div>
                                    </div>
                                </div>
                                <div class="o_kanban_record_body">
                                    <div>
                                        <strong>Village / ग्राम:</strong> <field name="village_id"/>
                                    </div>
                                    <div>
                                        <strong>Date / दिनाँक:</strong> <field name="survey_date"/>
                                    </div>
                                </div>
                                <div class="o_kanban_record_bottom">
                                    <div class="oe_kanban_bottom_left">
                                        <span class="badge badge-pill" t-attf-class="badge-#{record.state.raw_value == 'draft' and 'info' or record.state.raw_value == 'approved' and 'success' or 'danger'}">
                                            <field name="state"/>
                                        </span>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </t>
                </templates>
            </kanban>
        </field>
    </record>

    <!-- Custom Mail Message View to Hide Related Document Fields -->

</odoo>
