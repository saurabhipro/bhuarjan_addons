<?xml version="1.0" encoding="UTF-8"?>
<templates xml:space="preserve">
    <t t-name="bhuarjan.KmlViewer" owl="1">

        <!-- Full-width wrapper — breaks out of Odoo's field padding -->
        <div class="kml-viewer-root"
             style="
                width: 100%;
                min-height: 560px;
                display: flex;
                flex-direction: column;
                background: #0d1117;
                border-radius: 6px;
                overflow: hidden;
                position: relative;
                box-shadow: 0 2px 12px rgba(0,0,0,0.35);
             ">

            <!-- Error Banner -->
            <div t-if="state.error"
                 style="
                    background: #2d0b0b;
                    color: #ff8a80;
                    border-left: 4px solid #e53935;
                    padding: 10px 16px;
                    font-size: 0.85rem;
                    display: flex;
                    align-items: center;
                    gap: 8px;
                    z-index: 10;
                 ">
                <i class="fa fa-exclamation-circle" style="color:#e53935"/>
                <span><t t-esc="state.error"/></span>
            </div>

            <!-- Loading Overlay -->
            <div t-if="state.isLoading"
                 style="
                    position: absolute;
                    inset: 0;
                    background: rgba(13,17,23,0.9);
                    z-index: 9999;
                    display: flex;
                    flex-direction: column;
                    justify-content: center;
                    align-items: center;
                    gap: 16px;
                 ">
                <div style="
                    width: 44px; height: 44px;
                    border: 4px solid rgba(66,133,244,0.2);
                    border-top-color: #4285f4;
                    border-radius: 50%;
                    animation: kml-spin 0.8s linear infinite;
                "/>
                <p style="color:#8ab4f8; margin:0; font-size:0.88rem; letter-spacing:0.05em;">
                    <t t-esc="state.status"/>
                </p>
            </div>

            <!-- ★ Google Map — fills entire space ★ -->
            <div t-ref="mapContainer"
                 style="
                    flex: 1 1 auto;
                    width: 100%;
                    height: 580px;
                    min-height: 500px;
                    display: block;
                 "/>

            <!-- Status bar at bottom -->
            <div t-if="!state.isLoading"
                 style="
                    background: rgba(0,0,0,0.72);
                    color: #90caf9;
                    padding: 5px 14px;
                    font-size: 0.76rem;
                    letter-spacing: 0.04em;
                    display: flex;
                    align-items: center;
                    gap: 8px;
                    min-height: 26px;
                 ">
                <i class="fa fa-map-marker" style="color:#4285f4; font-size:0.9rem;"/>
                <span><t t-esc="state.status"/></span>
            </div>
        </div>

        <!-- Spinner animation -->
        <style>
            @keyframes kml-spin { to { transform: rotate(360deg); } }

            /* Make Odoo's field container transparent so map fills it */
            .o_field_widget.o_field_kml_viewer,
            .o_field_widget[name="kml_file"] {
                padding: 0 !important;
                width: 100% !important;
            }
        </style>
    </t>
</templates>
