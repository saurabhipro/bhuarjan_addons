<?xml version="1.0" encoding="utf-8"?>
<odoo>
    <!-- Survey List View -->
    <record id="view_bhu_survey_list" model="ir.ui.view">
        <field name="name">bhu.survey.list</field>
        <field name="model">bhu.survey</field>
        <field name="arch" type="xml">
            <list string="Surveys / ‡§∏‡§∞‡•ç‡§µ‡•á" decoration-info="state == 'draft'" decoration-success="state == 'approved'" decoration-danger="state == 'rejected'" decoration-muted="state == 'locked'">
                <field name="name"/>
                <field name="company_id"/>
                <field name="user_id"/>
                <field name="project_id"/>
                <field name="department_id"/>
                <field name="village_id"/>
                <field name="tehsil_id"/>
                <field name="khasra_number"/>
                <field name="total_area"/>
                <field name="acquired_area"/>
                <field name="survey_date"/>
                <field name="state" widget="badge"/>
            </list>
        </field>
    </record>

    <!-- Survey Form View -->
    <record id="view_bhu_survey_form" model="ir.ui.view">
        <field name="name">bhu.survey.form</field>
        <field name="model">bhu.survey</field>
        <field name="arch" type="xml">
            <form string="Survey / ‡§∏‡§∞‡•ç‡§µ‡•á">
                <header>
                    <button name="action_submit" string="Submit / ‡§™‡•ç‡§∞‡§∏‡•ç‡§§‡•Å‡§§ ‡§ï‡§∞‡•á‡§Ç" type="object" class="btn-primary" invisible="state != 'draft'"/>
                    <button name="action_approve" string="Approve / ‡§Ö‡§®‡•Å‡§Æ‡•ã‡§¶‡§ø‡§§ ‡§ï‡§∞‡•á‡§Ç" type="object" class="btn-success" invisible="state != 'submitted'"/>
                    <button name="action_reject" string="Reject / ‡§Ö‡§∏‡•ç‡§µ‡•Ä‡§ï‡•É‡§§ ‡§ï‡§∞‡•á‡§Ç" type="object" class="btn-danger" invisible="state != 'submitted'"/>
                    <button name="action_reset_to_draft" string="Reset to Draft / ‡§™‡•ç‡§∞‡§æ‡§∞‡•Ç‡§™ ‡§Æ‡•á‡§Ç ‡§∞‡•Ä‡§∏‡•á‡§ü" type="object" invisible="state != 'rejected'"/>
                    
                    <button name="action_download_form10" string="Download Form-10 / ‡§´‡§æ‡§∞‡•ç‡§Æ-10 ‡§°‡§æ‡§â‡§®‡§≤‡•ã‡§° ‡§ï‡§∞‡•á‡§Ç" type="object" class="btn-info" icon="fa-download"/>
                    <field name="state" widget="statusbar" statusbar_visible="draft,submitted,approved,locked"/>
                </header>
                <sheet>
                    <div class="oe_title">
                        <h1>
                            <field name="name" placeholder="Survey Number / ‡§∏‡§∞‡•ç‡§µ‡•á ‡§®‡§Ç‡§¨‡§∞"/>
                        </h1>
                    </div>
                    
                    <!-- Locked Survey Warning -->
                    <div class="alert alert-warning" role="alert" invisible="state != 'locked'">
                        <strong>Survey Locked / ‡§∏‡§∞‡•ç‡§µ‡•á ‡§≤‡•â‡§ï:</strong> This survey has been used to generate Notification 4 and is now locked. No further modifications are allowed.
                        <br/>
                        <strong>‡§∏‡§∞‡•ç‡§µ‡•á ‡§≤‡•â‡§ï:</strong> ‡§á‡§∏ ‡§∏‡§∞‡•ç‡§µ‡•á ‡§ï‡§æ ‡§â‡§™‡§Ø‡•ã‡§ó ‡§Ö‡§ß‡§ø‡§∏‡•Ç‡§ö‡§®‡§æ 4 ‡§ú‡•á‡§®‡§∞‡•á‡§ü ‡§ï‡§∞‡§®‡•á ‡§ï‡•á ‡§≤‡§ø‡§è ‡§ï‡§ø‡§Ø‡§æ ‡§ó‡§Ø‡§æ ‡§π‡•à ‡§î‡§∞ ‡§Ö‡§¨ ‡§Ø‡§π ‡§≤‡•â‡§ï ‡§π‡•à‡•§ ‡§ï‡•ã‡§à ‡§î‡§∞ ‡§∏‡§Ç‡§∂‡•ã‡§ß‡§® ‡§ï‡•Ä ‡§Ö‡§®‡•Å‡§Æ‡§§‡§ø ‡§®‡§π‡•Ä‡§Ç ‡§π‡•à‡•§
                    </div>
                    
                    <group>
                        <group string="Project Information / ‡§™‡§∞‡§ø‡§Ø‡•ã‡§ú‡§®‡§æ ‡§ï‡•Ä ‡§ú‡§æ‡§®‡§ï‡§æ‡§∞‡•Ä">
                            <field name="project_id" widget="selection" readonly="state == 'locked'"/>
                            <field name="department_id" widget="selection" readonly="state == 'locked'"/>
                            <field name="survey_date" widget="date" readonly="state == 'locked'"/>
                        </group>
                        <group string="Location Information / ‡§∏‡•ç‡§•‡§æ‡§® ‡§ï‡•Ä ‡§ú‡§æ‡§®‡§ï‡§æ‡§∞‡•Ä">
                            <field name="company_id" readonly="state == 'locked'"/>
                            <field name="village_id" widget="selection" readonly="state == 'locked'"/>
                            <field name="tehsil_id" widget="selection" readonly="state == 'locked'"/>
                            <field name="district_name" readonly="state == 'locked'"/>
                            <field name="user_id"/>

                        </group>
                    </group>
                    
                    <group>
                        <group>
                            <field name="survey_uuid" readonly="1"/>
                        </group>
                    </group>
                    
                    <group string="Landowners / ‡§≠‡•Ç‡§Æ‡§ø‡§∏‡•ç‡§µ‡§æ‡§Æ‡•Ä">
                        <field name="landowner_ids" widget="many2many_tags" options="{'no_create': False, 'no_create_edit': False}"/>
                    </group>
                    
                    <notebook>
                        <page string="Survey / ‡§∏‡§∞‡•ç‡§µ‡•á" name="survey_details">
                            <group>
                                <group string="Land Information / ‡§≠‡•Ç‡§Æ‡§ø ‡§ï‡•Ä ‡§ú‡§æ‡§®‡§ï‡§æ‡§∞‡•Ä">
                                    <field name="khasra_number" widget="char" readonly="state == 'locked'"/>
                                    <field name="total_area" widget="float" readonly="state == 'locked'"/>
                                    <field name="acquired_area" widget="float" readonly="state == 'locked'"/>
                                </group>
                                <group string="Crop Information / ‡§´‡§∏‡§≤ ‡§ï‡•Ä ‡§ú‡§æ‡§®‡§ï‡§æ‡§∞‡•Ä">
                                    <field name="is_single_crop" widget="boolean_toggle" readonly="state == 'locked'"/>
                                    <field name="is_double_crop" widget="boolean_toggle" readonly="state == 'locked'"/>
                                    <field name="is_irrigated" widget="boolean_toggle" readonly="state == 'locked'"/>
                                    <field name="is_unirrigated" widget="boolean_toggle" readonly="state == 'locked'"/>
                                </group>
                            </group>
                            
                            <group>
                                <group string="Tree Information / ‡§µ‡•É‡§ï‡•ç‡§∑ ‡§ï‡•Ä ‡§ú‡§æ‡§®‡§ï‡§æ‡§∞‡•Ä">
                                    <field name="tree_development_stage" widget="selection" readonly="state == 'locked'"/>
                                    <field name="tree_count" widget="integer" readonly="state == 'locked'"/>
                                </group>
                                <group string="House Information / ‡§ò‡§∞ ‡§ï‡•Ä ‡§ú‡§æ‡§®‡§ï‡§æ‡§∞‡•Ä">
                                    <field name="house_type" widget="selection" readonly="state == 'locked'"/>
                                    <field name="house_area" widget="float" readonly="state == 'locked'"/>
                                    <field name="shed_area" widget="float" readonly="state == 'locked'"/>
                                </group>
                            </group>
                            
                            <group>
                                <group string="Infrastructure / ‡§¨‡•Å‡§®‡§ø‡§Ø‡§æ‡§¶‡•Ä ‡§∏‡•Å‡§µ‡§ø‡§ß‡§æ‡§è‡§Ç">
                                    <field name="has_well" widget="boolean_toggle" readonly="state == 'locked'"/>
                                    <field name="well_type" widget="selection" invisible="not has_well" readonly="state == 'locked'"/>
                                    <field name="has_electricity" widget="boolean_toggle" readonly="state == 'locked'"/>
                                    <field name="has_road_access" widget="boolean_toggle" readonly="state == 'locked'"/>
                                    <field name="has_tubewell" widget="boolean_toggle" readonly="state == 'locked'"/>
                                    <field name="has_pond" widget="boolean_toggle" readonly="state == 'locked'"/>
                                </group>
                                <group string="Survey Image / ‡§∏‡§∞‡•ç‡§µ‡•á ‡§õ‡§µ‡§ø">
                                    <field name="survey_image" widget="image" class="oe_avatar"/>
                                    <field name="survey_image_filename" invisible="1"/>
                                </group>
                            </group>
                            
                            <group>
                                <group string="Attachments / ‡§∏‡§Ç‡§≤‡§ó‡•ç‡§®‡§ï">
                                    <field name="attachment_ids" widget="many2many_binary"/>
                                </group>
                            </group>
                            
                        </page>
                        
                        <page string="Landowner / ‡§≠‡•Ç‡§Æ‡§ø‡§∏‡•ç‡§µ‡§æ‡§Æ‡•Ä" name="landowners_details">
                            <field name="landowner_ids" readonly="1">
                                <list string="Landowner Details / ‡§≠‡•Ç‡§Æ‡§ø‡§∏‡•ç‡§µ‡§æ‡§Æ‡•Ä ‡§µ‡§ø‡§µ‡§∞‡§£" decoration-info="is_minor">
                                    <field name="name" string="Name / ‡§®‡§æ‡§Æ"/>
                                    <field name="father_name" string="Father's Name / ‡§™‡§ø‡§§‡§æ ‡§ï‡§æ ‡§®‡§æ‡§Æ"/>
                                    <field name="age" string="Age / ‡§Ü‡§Ø‡•Å"/>
                                    <field name="gender" string="Gender / ‡§≤‡§ø‡§Ç‡§ó"/>
                                    <field name="mobile" string="Mobile / ‡§Æ‡•ã‡§¨‡§æ‡§á‡§≤"/>
                                    <field name="email" string="Email / ‡§à‡§Æ‡•á‡§≤"/>
                                    <field name="village_id" string="Village / ‡§ó‡•ç‡§∞‡§æ‡§Æ"/>
                                    <field name="tehsil_id" string="Tehsil / ‡§§‡§π‡§∏‡•Ä‡§≤"/>
                                    <field name="district_id" string="District / ‡§ú‡§ø‡§≤‡§æ"/>
                                    <field name="aadhar_number" string="Aadhar / ‡§Ü‡§ß‡§æ‡§∞"/>
                                    <field name="pan_number" string="PAN / ‡§™‡•à‡§®"/>
                                    <field name="bank_name" string="Bank / ‡§¨‡•à‡§Ç‡§ï"/>
                                    <field name="account_number" string="Account / ‡§ñ‡§æ‡§§‡§æ"/>
                                    <field name="is_minor" string="Minor / ‡§®‡§æ‡§¨‡§æ‡§≤‡§ø‡§ó"/>
                                </list>
                            </field>
                        </page>
                    </notebook>
                    
                    <!-- Chatter removed -->
                </sheet>
                <chatter/>
            </form>
        </field>
    </record>

    <!-- Survey Search View -->
    <record id="view_bhu_survey_search" model="ir.ui.view">
        <field name="name">bhu.survey.search</field>
        <field name="model">bhu.survey</field>
        <field name="arch" type="xml">
            <search string="Search Surveys / ‡§∏‡§∞‡•ç‡§µ‡•á ‡§ñ‡•ã‡§ú‡•á‡§Ç">
                <field name="name"/>
                <field name="landowner_ids"/>
                <field name="project_id"/>
                <field name="department_id"/>
                <field name="village_id"/>
                <field name="tehsil_id"/>
                <field name="khasra_number"/>
                <field name="survey_date"/>
                <field name="survey_uuid"/>
                
                <field name="landowner_pan_numbers" string="Pan Number"/>
                <field name="landowner_aadhar_numbers" string="Aadhar Number"/>
            
                <filter string="Draft / ‡§™‡•ç‡§∞‡§æ‡§∞‡•Ç‡§™" name="draft" domain="[('state', '=', 'draft')]"/>

                <filter string="Submitted / ‡§™‡•ç‡§∞‡§∏‡•ç‡§§‡•Å‡§§" name="submitted" domain="[('state', '=', 'submitted')]"/>
                <filter string="Approved / ‡§Ö‡§®‡•Å‡§Æ‡•ã‡§¶‡§ø‡§§" name="approved" domain="[('state', '=', 'approved')]"/>
                <filter string="Rejected / ‡§Ö‡§∏‡•ç‡§µ‡•Ä‡§ï‡•É‡§§" name="rejected" domain="[('state', '=', 'rejected')]"/>
                
                <separator/>
                <filter string="This Month / ‡§á‡§∏ ‡§Æ‡§π‡•Ä‡§®‡•á" name="this_month" domain="[('survey_date', '>=', (context_today() - relativedelta(months=1)).strftime('%Y-%m-01')), ('survey_date', '&lt;', (context_today() + relativedelta(months=1)).strftime('%Y-%m-01'))]"/>
                <filter string="This Year / ‡§á‡§∏ ‡§∏‡§æ‡§≤" name="this_year" domain="[('survey_date', '>=', context_today().strftime('%Y-01-01')), ('survey_date', '&lt;', (context_today() + relativedelta(years=1)).strftime('%Y-01-01'))]"/>
                
                <group expand="0" string="Group By / ‡§∏‡§Æ‡•Ç‡§π ‡§¨‡§®‡§æ‡§è‡§Ç">
                    <filter string="State / ‡§∏‡•ç‡§•‡§ø‡§§‡§ø" name="group_state" context="{'group_by': 'state'}"/>
                    <filter string="Village / ‡§ó‡•ç‡§∞‡§æ‡§Æ" name="group_village" context="{'group_by': 'village_id'}"/>
                    <filter string="Tehsil / ‡§§‡§π‡§∏‡•Ä‡§≤" name="group_tehsil" context="{'group_by': 'tehsil_id'}"/>
                    <filter string="Khasra Number / ‡§ñ‡§∏‡§∞‡§æ ‡§®‡§Ç‡§¨‡§∞" name="group_khasra" context="{'group_by': 'khasra_number'}"/>
                    <filter string="Project / ‡§™‡§∞‡§ø‡§Ø‡•ã‡§ú‡§®‡§æ" name="group_project" context="{'group_by': 'project_id'}"/>
                    <filter string="Department / ‡§µ‡§ø‡§≠‡§æ‡§ó" name="group_department" context="{'group_by': 'department_id'}"/>
                    <filter string="Survey Date / ‡§∏‡§∞‡•ç‡§µ‡•á ‡§¶‡§ø‡§®‡§æ‡§Å‡§ï" name="group_survey_date" context="{'group_by': 'survey_date'}"/>
                </group>
            </search>
        </field>
    </record>

    <!-- Survey Action -->
    <record id="action_bhu_survey" model="ir.actions.act_window">
        <field name="name">Surveys / ‡§∏‡§∞‡•ç‡§µ‡•á</field>
        <field name="res_model">bhu.survey</field>
        <field name="view_mode">kanban,list,form</field>
        <field name="search_view_id" ref="view_bhu_survey_search"/>
        <field name="context">{'search_default_this_year': 1}</field>
        <field name="help" type="html">
            <p class="o_view_nocontent_smiling_face">
                Create your first Survey!
            </p>
            <p>
                Survey is used for preliminary land acquisition surveys.
                You can add multiple citizens/landowners in one survey.
            </p>
        </field>
    </record>

    <!-- Bulk Download Form-10 Action -->
    <record id="action_bulk_download_form10" model="ir.actions.server">
        <field name="name">Download Form-10 PDFs / ‡§´‡§æ‡§∞‡•ç‡§Æ-10 PDF ‡§°‡§æ‡§â‡§®‡§≤‡•ã‡§° ‡§ï‡§∞‡•á‡§Ç</field>
        <field name="model_id" ref="model_bhu_survey"/>
        <field name="binding_model_id" ref="model_bhu_survey"/>
        <field name="state">code</field>
        <field name="code">
if records:
    action = records.action_bulk_download_form10()
</field>
    </record>

    <!-- Survey Kanban View -->
    <record id="view_bhu_survey_kanban" model="ir.ui.view">
        <field name="name">bhu.survey.kanban</field>
        <field name="model">bhu.survey</field>
        <field name="arch" type="xml">
        <kanban string="Surveys / ‡§∏‡§∞‡•ç‡§µ‡•á" class="o_kanban_large_column o_kanban_mobile">
                <field name="name"/>
                <field name="project_id"/>
                <field name="village_id"/>
                <field name="state"/>
                <field name="survey_date"/>
                <field name="user_id"/>


                <templates>
                    <t t-name="kanban-box">
                    <div class="oe_kanban_card shadow-sm rounded-lg o_kanban_record">
                        <div class="oe_kanban_content p-3 bg-white border">
                            
                            <!-- Header -->
                            <div class="d-flex justify-content-between align-items-start mb-2">
                                <div>
                                    <h4 class="mb-1 text-primary">
                                            <field name="name"/>
                                    </h4>
                                    <small class="text-muted">
                                        <i class="fa fa-folder-open mr-1"/> <field name="project_id"/>
                                    </small>
                                </div>
                                <div class="dropdown">
                                    <a class="dropdown-toggle text-secondary" data-toggle="dropdown" href="#" title="More Actions">
                                        <i class="fa fa-ellipsis-v"/>
                                    </a>
                                    <div class="dropdown-menu dropdown-menu-right shadow" role="menu">
                                        <a role="menuitem" type="edit" class="dropdown-item">
                                            <i class="fa fa-pencil-alt mr-1"/> Edit
                                        </a>
                                        <a role="menuitem" type="delete" class="dropdown-item text-danger">
                                            <i class="fa fa-trash mr-1"/> Delete
                                        </a>
                                    </div>
                                </div>
                                    </div>

                            <!-- Body -->
                            <div class="mb-3">
                                <p class="mb-1">
                                    <strong>üèòÔ∏è Village / ‡§ó‡•ç‡§∞‡§æ‡§Æ:</strong> <field name="village_id"/>
                                </p>
                                <p class="mb-0">
                                    <strong>üìÖ Date / ‡§¶‡§ø‡§®‡§æ‡§Å‡§ï:</strong> <field name="survey_date"/>
                                </p>
                                <p class="mb-1">
                                    <strong>Surveyor:</strong> <field name="user_id"/>
                                </p>
                            </div>

                            <!-- Footer -->
                            <div class="d-flex justify-content-between align-items-center border-top pt-2">
                                <span t-attf-class="badge badge-pill px-3 py-2 text-uppercase 
                                    #{record.state.raw_value == 'approved' and 'badge-info' 
                                    or record.state.raw_value == 'locked' and 'badge-success' 
                                    or record.state.raw_value == 'submitted' and 'badge-warning' 
                                    or record.state.raw_value == 'draft' and 'badge-primary' 
                                    or 'badge-danger'}">
                                    <field name="state"/>
                                </span>
                                <span class="text-muted small">
                                    <i class="fa fa-camera"/> Survey
                                </span>
                            </div>

                            </div>
                        </div>
                    </t>
                </templates>
            </kanban>
        </field>
    </record>


    <!-- Custom Mail Message View to Hide Related Document Fields -->

</odoo>
