<?xml version="1.0" encoding="UTF-8"?>
<odoo>
    <!-- Section 21 Personal Notification Report -->
    <record id="action_report_section21_personal_notification" model="ir.actions.report">
        <field name="name">Section 21 Personal Notice / धारा 21 व्यक्तिगत नोटिस</field>
        <field name="model">bhu.section21.personal.notice</field>
        <field name="report_type">qweb-pdf</field>
        <field name="report_name">bhuarjan.section21_personal_notification_report</field>
        <field name="report_file">bhuarjan.section21_personal_notification_report</field>
        <field name="paperformat_id" ref="bhuarjan.bhuarjan_sia_paper_format"/>
        <field name="print_report_name">'Section21_Personal_Notice_' + ((object and object.landowner_id and object.landowner_id.name) or (docs and docs[0] and docs[0].landowner_id and docs[0].landowner_id.name) or 'All')</field>
    </record>

    <!-- Section 21 Personal Notification Report Template -->
    <template id="section21_personal_notification_report">
        <t t-call="web.html_container">
            <meta charset="utf-8"/>
            <t t-set="include_public_first" t-value="request.env.context.get('include_public_notice_first', False)"/>
            <t t-set="notification_id" t-value="request.env.context.get('section21_notification_id')"/>
            <t t-set="public_notification" t-value="notification_id and request.env['bhu.section21.notification'].sudo().browse(notification_id) or None"/>
            
            <!-- Include Public Notice First if flag is set - only once at the beginning -->
            <t t-if="include_public_first and public_notification">
                <!-- Render Public Notice Template - pass the notification as object -->
                <t t-call="web.html_container">
                    <meta charset="utf-8"/>
                    <t t-set="notification" t-value="public_notification"/>
                    <t t-call="bhuarjan.section21_public_notification_report"/>
                </t>
                <!-- Page Break -->
                <div style="page-break-before: always;"></div>
            </t>
            
            <!-- Render all personal notices - iterate through docs (Odoo populates docs with all records) -->
            <t t-set="all_personal_notices" t-value="docs if docs else (object and [object] or [])"/>
            <t t-set="notice_index" t-value="0"/>
            <t t-foreach="all_personal_notices" t-as="personal_notice">
                <t t-set="landowner" t-value="personal_notice and personal_notice.landowner_id or None"/>
                <t t-set="notification" t-value="personal_notice and personal_notice.notification_id or None"/>
                <t t-set="khasra_number" t-value="personal_notice and personal_notice.khasra_number or None"/>
                <!-- Ensure land_parcel_ids are loaded - reload notification to get related records -->
                <t t-set="notification" t-value="notification and notification.id and request.env['bhu.section21.notification'].sudo().browse(notification.id) or None"/>
                <t t-set="land_parcels" t-value="notification and notification.land_parcel_ids or []"/>
                
                <!-- Page break between personal notices (not before the first one) -->
                <t t-if="notice_index > 0">
                    <div style="page-break-before: always;"></div>
                </t>
                <t t-set="notice_index" t-value="notice_index + 1"/>
                
                <t t-if="notification">
                    <t t-call="web.basic_layout">
                <style>
                    /* Override basic_layout styles aggressively */
                    body, html, .container, .page {
                        font-size: 18px !important;
                        font-family: 'Noto Sans Devanagari', 'Mangal', 'Arial Unicode MS', 'DejaVu Sans', sans-serif !important;
                    }
                    .letter_space {
                        letter-spacing: 1px !important;
                    }
                    /* Global Font Settings */
                    body, .header-section, h2, h3, strong, span, td, th, p, div, .container, .page {
                        font-family: 'Noto Sans Devanagari', 'Mangal', 'Arial Unicode MS', 'DejaVu Sans', sans-serif !important;
                    }
                    /* Schedule table styling */
                    .schedule-table {
                        width: 100% !important;
                        border-collapse: collapse !important;
                        margin: 8px 0 !important;
                        border: 2px solid #000 !important;
                        font-size: 18px !important;
                    }
                    .schedule-table th, .schedule-table td {
                        border: 1px solid #000 !important;
                        padding: 6px !important;
                        text-align: center !important;
                        font-size: 18px !important;
                        vertical-align: middle !important;
                    }
                    .schedule-table th {
                        background-color: #f5f5f5 !important;
                        font-weight: bold !important;
                        font-size: 18px !important;
                        padding: 7px 8px !important;
                    }
                    /* Watermark with Logo - Centered on Page */
                    .watermark {
                        position: absolute;
                        top: 50%;
                        left: 50%;
                        transform: translate(-50%, -50%);
                        opacity: 0.1;
                        z-index: 0;
                        pointer-events: none;
                        width: 600px;
                        height: 600px;
                        margin: 0;
                        padding: 0;
                        display: flex;
                        flex-direction: column;
                        align-items: center;
                        justify-content: center;
                    }
                    .watermark img {
                        width: 500px;
                        height: 500px;
                        object-fit: contain;
                    }
                    .watermark-circle {
                        position: absolute;
                        width: 550px;
                        height: 550px;
                        border: 2px solid rgba(0, 0, 0, 0.1);
                        border-radius: 50%;
                        top: 50%;
                        left: 50%;
                        transform: translate(-50%, -50%);
                        z-index: -1;
                    }
                    /* Ensure content is above watermark */
                    .container {
                        position: relative;
                        z-index: 1;
                        background: transparent;
                        box-sizing: border-box;
                    }
                    /* Ensure page takes full height */
                    body, html {
                        height: 100%;
                        margin: 0;
                        padding: 0;
                        font-size: 18px !important;
                    }
                    @page {
                        size: A4;
                        margin: 0;
                    }
                </style>

                <div class="container letter_space" style="border: 2px dotted #000; padding: 15px; margin: 10px; position: relative; min-height: calc(100vh - 20px); height: 100%;">
                    <!-- Watermark with Logo - Centered on Page -->
                    <t t-set="base_url" t-value="request.env['ir.config_parameter'].sudo().get_param('web.base.url') or ''"/>
                    <div class="watermark">
                        <div class="watermark-circle"></div>
                        <t t-if="base_url">
                            <img t-att-src="base_url + '/bhuarjan/static/description/logo.png'" alt="Logo Watermark" style="max-width: 100%; height: auto;"/>
                        </t>
                    </div>
                    <!-- Header: Collector's Court -->
                    <div style="text-align: center; margin-bottom: 8px;">
                        <h2 style="margin: 0; padding: 0; font-size: 22px; font-weight: bold;">
                            <strong>न्यायालय कलेक्टर, जिला-<span t-if="notification and notification.district_id" t-esc="notification.district_id.name"/><span t-if="not notification or not notification.district_id">रायगढ़</span> (छ.ग.)</strong>
                        </h2>
                    </div>

                    <!-- Recipient Details -->
                    <div style="margin-bottom: 8px; font-size: 18px !important;">
                        <div style="margin-bottom: 4px;">
                            <strong>प्रति,</strong>
                        </div>
                        <div style="margin-bottom: 3px;">
                            <strong>भूमिस्वामी</strong>
                            <span t-if="landowner and landowner.name" t-esc="landowner.name"/>
                            <span t-if="not landowner or not landowner.name" style="text-decoration: underline;">........................</span>
                        </div>
                        <div style="margin-bottom: 3px;">
                            <strong>पिता/पति</strong>
                            <span t-if="landowner and (landowner.father_name or landowner.spouse_name)" t-esc="landowner.father_name or landowner.spouse_name"/>
                            <span t-if="not landowner or (not landowner.father_name and not landowner.spouse_name)" style="text-decoration: underline;">........................</span>
                        </div>
                        <div style="margin-bottom: 3px;">
                            <strong>पता</strong>
                            <span t-if="landowner and landowner.owner_address" t-esc="landowner.owner_address"/>
                            <span t-if="not landowner or not landowner.owner_address" style="text-decoration: underline;">........................</span>
                        </div>
                    </div>

                    <!-- Subject Section -->
                    <div style="margin-bottom: 8px; font-size: 18px !important;">
                        <div style="display: flex; justify-content: space-between; margin-bottom: 3px;">
                            <div>
                                <strong>विषयः- अपेक्षक निकाय :-</strong>
                                <span t-if="notification and notification.requisitioning_body" t-esc="notification.requisitioning_body"/>
                                <span t-if="not notification or not notification.requisitioning_body" style="text-decoration: underline;">........................</span>
                            </div>
                            <div>
                                <strong>(छ.ग.) के</strong>
                                <span t-if="notification and notification.project_id and notification.project_id.name" t-esc="notification.project_id.name"/>
                                <span t-if="not notification or not notification.project_id or not notification.project_id.name" style="text-decoration: underline;">........................</span>
                                <strong>प्रयोजन</strong>
                            </div>
                        </div>
                        <div style="margin-top: 3px;">
                            हेतु भूमि अर्जन, पुनर्वासन और पुनर्व्यवस्थापन में उचित प्रतिकर और पारदर्शिता का अधिकार अधिनियम, 2013 के धारा-21 (1) के तहत व्यक्तिशः नोटिस ।
                        </div>
                    </div>

                    <!-- Separator -->
                    <div style="text-align: center; margin: 8px 0; font-size: 18px !important;">
                        <strong>-00-</strong>
                    </div>

                    <!-- Main Body Text -->
                    <div style="font-size: 18px !important; line-height: 1.5 !important; text-align: justify; margin-bottom: 8px;">
                        <p style="margin: 0; padding: 0; font-size: 18px !important; line-height: 1.5 !important;">
                            राज्य शासन को नीचे दी गयी अनुसूची में दर्शित भूमि की सार्वजनिक प्रयोजन(
                            <span t-if="notification and notification.public_purpose" t-esc="notification.public_purpose"/>
                            <span t-if="not notification or not notification.public_purpose" style="text-decoration: underline;">........................</span>
                            ) हेतु आवश्यकता है एवं राज्य शासन का आशय उवत भूमि का कब्जा लिये जाने का है। अतः भूमि अर्जन, पुनर्वासन और पुनर्व्यवस्थापन में उचित प्रतिकर और पारदर्शिता का अधिकार अधिनियम, 2013 की धारा-21 (1) के तहत आपको सूचित किया जाता है कि भूमि में सभी हितों के लिये प्रतिकरों, पुनर्वास तथा प्रतिस्थापन के दावे, ऐसे हितों के लिये प्रतिकर के रकम संबंधित दावे, धारा 20 के अधीन किये गये मापमानों के दावे एवं आक्षेप आपत्ति / कथन यदि कोई हों,                             तो स्वंय अथवा अपने अधिकृत प्रतिनिधि या अधिववता के माध्यम से कार्यालय कलेक्टर, जिला रायगढ़ के भू-अर्जन शाखा में उपस्थित होकर कार्यालयीन दिवस एवं समय में प्रस्तुत कर सकते हैं।
                        </p>
                    </div>

                    <!-- Schedule Separator -->
                    <div style="text-align: center; margin: 10px 0; font-size: 18px !important; font-weight: bold;">
                        <strong>// अनूसूची //</strong>
                    </div>

                    <!-- Land Details Section -->
                    <div style="margin: 10px 0;">
                        <div style="text-align: left; font-size: 18px; font-weight: bold; margin-bottom: 6px;">
                            <strong>1) भूमि का विवरण :-</strong>
                        </div>
                        <div style="margin-bottom: 8px; font-size: 18px !important;">
                            <div style="margin-bottom: 3px;">
                                <strong>(क) जिला :-</strong>
                                <span t-if="notification and notification.district_id" t-esc="notification.district_id.name"/>
                                <span t-if="not notification or not notification.district_id">रायगढ़</span>
                            </div>
                            <div style="margin-bottom: 3px;">
                                <strong>(ख) तहसील :-</strong>
                                <span t-if="notification and notification.tehsil_id" t-esc="notification.tehsil_id.name"/>
                                <span t-if="not notification or not notification.tehsil_id" style="text-decoration: underline;">........................</span>
                            </div>
                            <div style="margin-bottom: 3px;">
                                <strong>(ग) ग्राम :-</strong>
                                <span t-if="notification and notification.village_id" t-esc="notification.village_id.name"/>
                                <span t-if="not notification or not notification.village_id" style="text-decoration: underline;">........................</span>
                            </div>
                        </div>

                        <!-- Land Parcels Table - Show only the specific khasra for this personal notice -->
                        <t t-set="parcel_data" t-value="None"/>
                        <t t-if="land_parcels and khasra_number">
                            <t t-foreach="land_parcels" t-as="parcel">
                                <t t-set="parcel_khasra" t-value="str(parcel.khasra_number) if parcel.khasra_number else ''"/>
                                <t t-set="target_khasra" t-value="str(khasra_number) if khasra_number else ''"/>
                                <t t-if="parcel_khasra == target_khasra">
                                    <t t-set="parcel_data" t-value="parcel"/>
                                </t>
                            </t>
                        </t>
                        <table class="schedule-table">
                            <thead>
                                <tr>
                                    <th style="width: 33.33%;">खसरा क्रमांक</th>
                                    <th style="width: 33.33%;">अर्जित रकबा</th>
                                    <th style="width: 33.33%;">रिमार्क</th>
                                </tr>
                            </thead>
                            <tbody>
                                <t t-if="parcel_data">
                                    <tr>
                                        <td style="font-size: 18px !important; text-align: center;">
                                            <t t-if="parcel_data.khasra_number" t-esc="parcel_data.khasra_number"/>
                                            <t t-if="not parcel_data.khasra_number">........................</t>
                                        </td>
                                        <td style="font-size: 18px !important; text-align: center;">
                                            <t t-if="parcel_data.area_hectares and parcel_data.area_hectares > 0" t-esc="'{:.4f}'.format(parcel_data.area_hectares)"/>
                                            <t t-if="not parcel_data.area_hectares or parcel_data.area_hectares == 0">........................</t>
                                        </td>
                                        <td style="font-size: 18px !important; text-align: center;">
                                            <t t-if="parcel_data.remark" t-esc="parcel_data.remark"/>
                                            <t t-if="not parcel_data.remark">--</t>
                                        </td>
                                    </tr>
                                </t>
                                <t t-if="not parcel_data">
                                    <tr>
                                        <td style="text-align: center; padding: 8px; font-size: 18px !important;">
                                            <t t-if="khasra_number" t-esc="khasra_number"/>
                                            <t t-if="not khasra_number">........................</t>
                                        </td>
                                        <td style="text-align: center; padding: 8px; font-size: 18px !important;">........................</td>
                                        <td style="text-align: center; padding: 8px; font-size: 18px !important;">--</td>
                                    </tr>
                                </t>
                            </tbody>
                        </table>
                    </div>

                    <!-- Collector Signature -->
                    <div style="text-align: right; margin-top: 15px; margin-right: 0;">
                        <div style="margin: 5px 0; font-size: 18px !important;">
                            <span t-if="notification and notification.collector_name" t-esc="notification.collector_name"/>
                            <span t-if="not notification or not notification.collector_name">कलेक्टर</span>
                        </div>
                        <div style="margin: 3px 0; font-size: 18px !important;">
                            जिला-<span t-if="notification and notification.district_id" t-esc="notification.district_id.name"/><span t-if="not notification or not notification.district_id">रायगढ़</span>
                        </div>
                    </div>
                </div>
                
                <!-- Page Break for Copy Recipients Section -->
                <div style="page-break-before: always;"></div>
                
                <!-- Copy Recipients Section -->
                <div class="container letter_space" style="border: 2px dotted #000; padding: 15px; margin: 10px; position: relative; min-height: calc(100vh - 20px); height: 100%;">
                    <!-- Watermark with Logo - Centered on Page -->
                    <t t-set="base_url" t-value="request.env['ir.config_parameter'].sudo().get_param('web.base.url') or ''"/>
                    <div class="watermark">
                        <div class="watermark-circle"></div>
                        <t t-if="base_url">
                            <img t-att-src="base_url + '/bhuarjan/static/description/logo.png'" alt="Logo Watermark" style="max-width: 100%; height: auto;"/>
                        </t>
                    </div>
                    <!-- Copy Recipients Section Header -->
                    <div style="display: flex; justify-content: space-between; margin-bottom: 10px; font-size: 18px !important;">
                        <div>
                            <strong>पृ. क्रमांक /</strong>
                            <span style="text-decoration: underline;">........................</span>
                            <strong>भू-अर्जन / 2025,</strong>
                        </div>
                        <div>
                            <strong>दिनांक</strong>
                            <span t-if="notification and notification.notice_date" t-esc="notification.notice_date.strftime('%d/%m/%Y')"/>
                            <span t-if="not notification or not notification.notice_date" style="text-decoration: underline;">..../..../....</span>
                        </div>
                    </div>

                    <!-- Copy Recipients Title -->
                    <div style="margin-bottom: 8px; font-size: 18px !important;">
                        <strong>प्रतिलिपि :-</strong>
                    </div>

                    <!-- Copy Recipients Points -->
                    <div style="margin-bottom: 8px; font-size: 18px !important; line-height: 1.5;">
                        <div style="margin-bottom: 6px;">
                            <strong>1.</strong> अनुविभागीय अधिकारी (राजस्व) सह भू-अर्जन अधिकारी,
                            <span style="text-decoration: underline;">........................</span>
                            जिला रायगढ़ की ओर सूचनार्थ एवं आवश्यक कार्यवाही हेतु। आप प्रभावित भू-स्वामियों को सूचना तामिली कराकर प्राप्ति अभिस्वीकृति इस कार्यालय को उपलब्ध कराना सुनिश्चित करें।
                        </div>
                        <div style="margin-bottom: 6px;">
                            <strong>2.</strong> भूमिस्वामी
                            <span t-if="landowner and landowner.name" t-esc="landowner.name"/>
                            <span t-if="not landowner or not landowner.name" style="text-decoration: underline;">........................</span>
                            की ओर सूचनार्थ एवं लेख है कि प्रतिकर, पुनर्वासन एवं पुनर्व्यवस्थापन में तय की गई रकम संबंधी जानकारी अनुविभागीय अधिकारी (राजस्व) सह भू-अर्जन अधिकारी,
                            <span style="text-decoration: underline;">........................</span>
                            के कार्यालय में कार्यालयीन समय पर उपस्थित होकर प्राप्त की जा सकती है।
                        </div>
                    </div>

                    <!-- Additional Collector Signature -->
                    <div style="text-align: right; margin-top: 15px; margin-right: 0;">
                        <div style="margin: 5px 0; font-size: 18px !important;">
                            <span t-if="notification and notification.additional_collector_name" t-esc="notification.additional_collector_name"/>
                            <span t-if="not notification or not notification.additional_collector_name">अपर कलेक्टर</span>
                        </div>
                        <div style="margin: 3px 0; font-size: 18px !important;">
                            जिला-<span t-if="notification and notification.district_id" t-esc="notification.district_id.name"/><span t-if="not notification or not notification.district_id">रायगढ़</span>
                        </div>
                    </div>
                </div>
                    </t>
                </t>
            </t>
        </t>
    </template>
</odoo>

