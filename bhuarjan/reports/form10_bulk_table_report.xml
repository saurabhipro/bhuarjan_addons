<?xml version="1.0" encoding="utf-8"?>
<odoo>
    <!-- Bulk Form 10 Table Report (one PDF with all surveys row-by-row) -->
    <record id="action_report_form10_bulk_table" model="ir.actions.report">
        <field name="name">Form 10 - Bulk Table</field>
        <field name="model">bhu.survey</field>
        <field name="report_type">qweb-pdf</field>
        <field name="report_name">bhuarjan.form10_bulk_table_report</field>
        <field name="report_file">bhuarjan.form10_bulk_table_report</field>
        <field name="paperformat_id" ref="bhuarjan.bhuarjan_form10_paper_format"/>
        <field name="print_report_name">'Form10_Bulk_' + (object and object[0].project_id.name or 'All')</field>
        <field name="binding_model_id" eval="False"/>
        <field name="binding_view_types" eval="False"/>
    </record>
    
    <!-- Custom Layout header and footer -->
    <template id="report_custom_external_layout">
        <!-- Multicompany -->
        <t t-if="not o and doc">
            <t t-set="o" t-value="doc"/>
        </t>
        <t t-if="o and 'company_id' in o">
            <t t-set="company" t-value="o.company_id"></t>
        </t>
        <t t-if="not o or not 'company_id' in o">
            <t t-set="company" t-value="res_company"></t>
        </t>
        <!-- Set first survey - check multiple possible variable names -->
        <t t-if="not first">
            <t t-if="surveys and len(surveys) &gt; 0">
                <t t-set="first" t-value="surveys[0]"/>
            </t>
            <t t-elif="docs and len(docs) &gt; 0">
                <t t-set="first" t-value="docs[0]"/>
            </t>
            <t t-elif="doc">
                <t t-set="first" t-value="doc"/>
            </t>
        </t>
        <!-- Custom Header -->
        <div class="header o_clearfix" style="width: 100%; margin-bottom: 20px;">
            <style>
                .header-info-table { 
                    width: 100%; 
                    border-collapse: collapse; 
                    font-size: 14px; 
                    border: 2px solid #000; 
                    margin-bottom: 0; 
                    table-layout: fixed;
                }
                .header-info-table td { 
                    border: 1px solid #000; 
                    padding: 6px; 
                    vertical-align: middle;
                }
                .header h2 {
                    margin: 0 0 12px 0;
                    text-align: center;
                }
            </style>
            <h2 style="text-decoration: underline; margin: 0 0 12px 0; text-align: center; font-size: 28px; font-weight: bold;"><strong>भू अर्जन प्रारंभिक सर्वे प्रपत्र</strong></h2>

            <table class="header-info-table table1" >
                <tr>
                    <td rowspan="3" style="width: 10%; padding: 0; text-align: center; vertical-align: middle;">
                        <!-- Logo -->
                        <img src="/bhuarjan/static/description/logo.png" 
                             alt="Logo" 
                             style="width: 100%; height: auto; max-width: 100%; display: block; margin: 0; padding: 2px;"/>
                    </td>
                    <td style="width: 40%;">
                        <strong>परियोजना का नाम :</strong>
                        <span t-if="first" t-field="first.project_id.name"/>
                    </td>
                    <td style="width: 40%;">
                        <strong>विभाग का नाम</strong>
                        <span t-if="first" t-field="first.department_id.name"/>
                    </td>
                    <td rowspan="3" style="width: 10%; padding: 0; text-align: center; vertical-align: middle;">
                        <!-- QR Code -->
                        <t t-if="first">
                            <t t-set="qr_code_img" t-value="first.get_qr_code_data()"/>
                            <t t-set="qr_download_url" t-value="'https://bhuarjan.com/bhuarjan/form10/' + str(first.project_id.project_uuid or '') + '/' + str(first.village_id.village_uuid or '') + '/download'"/>
                            <t t-if="qr_code_img">
                                <a t-att-href="qr_download_url" style="display: block; width: 100%; margin: 0; padding: 0; text-decoration: none;">
                                    <img t-att-src="'data:image/png;base64,' + qr_code_img" 
                                         alt="QR Code - Click to download PDF" 
                                         style="width: 100%; max-width: 100%; height: auto; aspect-ratio: 1; border: none; display: block; margin: 0; padding: 0;"/>
                                </a>
                            </t>
                            <t t-if="not qr_code_img">
                                <a t-att-href="qr_download_url" style="display: block; width: 100%; margin: 0; padding: 0; text-decoration: none;">
                                    <div style="width: 100%; padding-top: 100%; position: relative; border: none; background: white; margin: 0;">
                                        <div style="position: absolute; top: 0; left: 0; width: 100%; height: 100%; display: flex; align-items: center; justify-content: center;">
                                            <div style="text-align: center; font-size: 7px;">
                                                <div style="font-weight: bold;">QR Code</div>
                                            </div>
                                        </div>
                                    </div>
                                </a>
                            </t>
                        </t>
                    </td>
                </tr>
                <tr>
                    <td style="width: 40%;">
                        <strong>ग्राम का नाम</strong>
                        <span t-if="first" t-field="first.village_id.name"/>
                    </td>
                    <td style="width: 40%;">
                        <strong>तहसील का नाम</strong>
                        <span t-if="first" t-field="first.tehsil_id.name"/> <strong>जिला-रायगढ़ (छ.ग.)</strong>
                    </td>
                </tr>
                <tr>
                    <td colspan="2">
                        <strong>सर्वे दिनाँक</strong>
                        <span t-if="first" t-field="first.survey_date" t-options="{'widget': 'date', 'format': 'dd/MM/yyyy'}"/>
                    </td>
                </tr>
            </table>

            <table class="bulk-form10-table" style="border-collapse: collapse; width: 100%; border: 2px solid #000; table-layout: fixed;">
                <thead>
                    <tr>
                        <th rowspan="2" style="text-align:center; border: 2px solid #000; background-color: #D3D3D3; color: #000000; padding: 8px; width: 2%;"><strong>क्र.</strong></th>
                        <th rowspan="2" style="text-align:center; border: 2px solid #000; background-color: #D3D3D3; color: #000000; padding: 8px; width: 5%;"><strong>प्रभावित खसरा क्रमांक</strong></th>
                        <th rowspan="2" style="text-align:center; border: 2px solid #000; background-color: #D3D3D3; color: #000000; padding: 8px; width: 4%;"><strong>कुल रकबा (हे.में.)</strong></th>
                        <th rowspan="2" style="text-align:center; border: 2px solid #000; background-color: #D3D3D3; color: #000000; padding: 8px; width: 5%;"><strong>अर्जन हेतु प्रस्तावित क्षेत्रफल (हेक्टेयर)</strong></th>
                        <th rowspan="2" style="text-align:center; border: 2px solid #000; background-color: #D3D3D3; color: #000000; padding: 8px; width: 8%;"><strong>भूमिस्वामी का नाम</strong></th>
                        <th colspan="4" style="text-align:center; border: 2px solid #000; background-color: #D3D3D3; color: #000000; padding: 8px;"><strong>भूमि का प्रकार</strong></th>
                        <th colspan="3" style="text-align:center; border: 2px solid #000; background-color: #D3D3D3; color: #000000; padding: 8px;"><strong>भूमि पर स्थित वृक्ष की संख्या (प्रजातिवार)</strong></th>
                        <th colspan="6" style="text-align:center; border: 2px solid #000; background-color: #D3D3D3; color: #000000; padding: 8px;"><strong>भूमि पर स्थित परिसंपत्तियों का विवरण</strong></th>
                    </tr>
                    <tr>
                        <th style="text-align:center; border: 2px solid #000; background-color: #D3D3D3; color: #000000; padding: 8px;"><strong>एक फसली</strong></th>
                        <th style="text-align:center; border: 2px solid #000; background-color: #D3D3D3; color: #000000; padding: 8px;"><strong>दो फसली</strong></th>
                        <th style="text-align:center; border: 2px solid #000; background-color: #D3D3D3; color: #000000; padding: 8px;"><strong>सिंचित</strong></th>
                        <th style="text-align:center; border: 2px solid #000; background-color: #D3D3D3; color: #000000; padding: 8px;"><strong>असिंचित</strong></th>
                        <th style="text-align:center; border: 2px solid #000; background-color: #D3D3D3; color: #000000; padding: 8px;"><strong>अविकसित</strong></th>
                        <th style="text-align:center; border: 2px solid #000; background-color: #D3D3D3; color: #000000; padding: 8px;"><strong>अर्द्ध विकसित</strong></th>
                        <th style="text-align:center; border: 2px solid #000; background-color: #D3D3D3; color: #000000; padding: 8px;"><strong>पूर्ण विकसित</strong></th>
                        <th style="text-align:center; border: 2px solid #000; background-color: #D3D3D3; color: #000000; padding: 8px;"><strong>मकान (कच्चा/पक्का) क्षेत्रफल वर्गफुट में</strong></th>
                        <th style="text-align:center; border: 2px solid #000; background-color: #D3D3D3; color: #000000; padding: 8px;"><strong>शेड (क्षेत्रफल वर्गफुट में)</strong></th>
                        <th style="text-align:center; border: 2px solid #000; background-color: #D3D3D3; color: #000000; padding: 8px;"><strong>कुँआ (कच्चा/पक्का) (हाँ/नहीं)</strong></th>
                        <th style="text-align:center; border: 2px solid #000; background-color: #D3D3D3; color: #000000; padding: 8px;"><strong>ट्यूबवेल / सम्बमर्शिबल पम्प फिटिंग सहित (हाँ/नहीं)</strong></th>
                        <th style="text-align:center; border: 2px solid #000; background-color: #D3D3D3; color: #000000; padding: 8px;"><strong>तालाब (हाँ/नहीं)</strong></th>
                        <th style="text-align:center; border: 2px solid #000; background-color: #D3D3D3; color: #000000; padding: 8px;"><strong>रिमार्क</strong></th>
                    </tr>
                </thead>
            </table>
        </div>
        <!-- Custom Footer -->
        <div class="footer o_standard_footer" style="position: relative;">
            <table style="width:100%; border: 1px solid white;">
                <tr>
                    <td style="width:20%; text-align:center; padding:6px; border: none;">
                        <p style="margin: 4px 0; font-size: 16px; font-weight: 700;">(हस्ताक्षर)</p>
                        <p style="margin: 4px 0; font-size: 16px; font-weight: 700;">अपेक्षक निकाय के</p>
                        <p style="margin: 4px 0; font-size: 16px; font-weight: 700;">अधिकृत प्रतिनिधि</p>
                        <p style="margin: 4px 0; font-size: 16px; font-weight: 700;">नाम -</p>
                        <p style="margin: 4px 0; font-size: 16px; font-weight: 700;">पदनाम</p>
                    </td>
                    <td style="width:20%; text-align:center; padding:6px; border: none;">
                        <p style="margin: 4px 0; font-size: 16px; font-weight: 700;">(हस्ताक्षर)</p>
                        <p style="margin: 4px 0; font-size: 16px; font-weight: 700;">तहसीलदार</p>
                        <p style="margin: 4px 0; font-size: 16px; font-weight: 700;">नाम -</p>
                    </td>
                    <td style="width:20%; text-align:center; padding:6px; border: none;">
                        <p style="margin: 4px 0; font-size: 16px; font-weight: 700;">(हस्ताक्षर)</p>
                        <p style="margin: 4px 0; font-size: 16px; font-weight: 700;">नायब तहसीलदार</p>
                        <p style="margin: 4px 0; font-size: 16px; font-weight: 700;">नाम -</p>
                    </td>
                    <td style="width:20%; text-align:center; padding:6px; border: none;">
                        <p style="margin: 4px 0; font-size: 16px; font-weight: 700;">(हस्ताक्षर)</p>
                        <p style="margin: 4px 0; font-size: 16px; font-weight: 700;">राजस्व निरीक्षक</p>
                        <p style="margin: 4px 0; font-size: 16px; font-weight: 700;">नाम-</p>
                        <p style="margin: 4px 0; font-size: 16px; font-weight: 700;">रा.नि.मं.</p>
                    </td>
                    <td style="width:20%; text-align:center; padding:6px; border: none;">
                        <p style="margin: 4px 0; font-size: 16px; font-weight: 700;">(हस्ताक्षर)</p>
                        <p style="margin: 4px 0; font-size: 16px; font-weight: 700;">पटवारी</p>
                        <p style="margin: 4px 0; font-size: 16px; font-weight: 700;">नाम-</p>
                        <p style="margin: 4px 0; font-size: 16px; font-weight: 700;">हल्का नम्बर</p>
                    </td>
                </tr>
            </table>
        </div>

        <div class="article o_report_layout_standard"
         t-att-data-oe-model="o and o._name"
         t-att-data-oe-id="o and o.id"
         t-att-data-oe-lang="o and o.env.context.get('lang')"
         style="margin-top: 0;">
        <t t-raw="0"/>
    </div>
        
    </template>


    <template id="form10_bulk_table_report">
        <t t-set="surveys" t-value="docs"/>
        <t t-set="first" t-value="surveys and surveys[0] or False"/>
        <t t-call="web.html_container">
            <t t-call="bhuarjan.report_custom_external_layout">  
                <div class="page">
                    <style>
                        .bulk-form10-table {
                            border-collapse: collapse;
                            width: 100%;
                            table-layout: fixed;
                        }
                        .bulk-form10-table thead th:nth-child(1) { width: 2%; }
                        .bulk-form10-table thead th:nth-child(2) { width: 5%; }
                        .bulk-form10-table thead th:nth-child(3) { width: 4%; }
                        .bulk-form10-table thead th:nth-child(4) { width: 5%; }
                        .bulk-form10-table thead th:nth-child(5) { width: 8%; }
                        .bulk-form10-table tbody td:nth-child(1) { width: 2%; }
                        .bulk-form10-table tbody td:nth-child(2) { width: 5%; }
                        .bulk-form10-table tbody td:nth-child(3) { width: 4%; }
                        .bulk-form10-table tbody td:nth-child(4) { width: 5%; }
                        .bulk-form10-table tbody td:nth-child(5) { width: 8%; }
                        .bulk-form10-table td, th {
                            border: 1px solid #000; 
                            font-size: 14px;
                            padding: 3px;
                            word-wrap: break-word;
                            overflow-wrap: break-word;
                            vertical-align: top;
                        }
                        .bulk-form10-table thead {
                            display: table-header-group;
                            -fs-table-paginate: paginate;
                        }
                        .bulk-form10-table thead tr {
                            page-break-inside: avoid;
                            page-break-after: avoid;
                        }
                        .bulk-form10-table thead th {
                            background-color: #D3D3D3;
                            color: #000000;
                            font-weight: bold;
                            position: relative;
                            page-break-inside: avoid;
                            border: 2px solid #000;
                            padding: 8px;
                        }
                        .bulk-form10-table tbody {
                            display: table-row-group;
                        }
                        .bulk-form10-table tbody tr {
                            page-break-inside: avoid;
                            page-break-after: auto;
                        }
                        .bulk-form10-table tbody td {
                            page-break-inside: avoid;
                        }
                        /* Page settings */
                        @page {
                            margin-top: 8cm;
                            margin-bottom: 2cm;
                            margin-left: 1cm;
                            margin-right: 1cm;
                        }
                        .content-wrapper {
                            margin-top: 0;
                        }
                    </style>
                    <div class="content-wrapper">
                        <table class="bulk-form10-table" style="margin-top: 0; border: 2px solid #000;">
                            
                            <tbody>
                                <t t-foreach="surveys" t-as="s">
                                    <tr style="page-break-inside: avoid; page-break-after: auto;">
                                        <td style="text-align:center"><t t-esc="s_index + 1"/></td>
                                                <td style="text-align:center">
                                                    <t t-if="s.khasra_number">
                                                        <t t-esc="s.khasra_number"/>
                                                    </t>
                                                    <span t-if="not s.khasra_number" style="color:#dc3545;font-weight:bold">नहीं</span>
                                                </td>
                                                <td style="text-align:center">
                                                    <t t-if="s.total_area is not None">
                                                        <t t-esc="s.total_area"/>
                                                    </t>
                                                    <span t-if="s.total_area is None" style="color:#dc3545;font-weight:bold">नहीं</span>
                                                </td>
                                                <td style="text-align:center">
                                                    <t t-if="s.acquired_area is not None">
                                                        <t t-esc="s.acquired_area"/>
                                                    </t>
                                                    <span t-if="s.acquired_area is None" style="color:#dc3545;font-weight:bold">नहीं</span>
                                                </td>
                                                <td style="page-break-inside: avoid;">
                                                    <t t-if="s.landowner_ids and len(s.landowner_ids) &gt; 0">
                                                        <t t-set="counter" t-value="1"/>
                                                        <t t-foreach="s.landowner_ids" t-as="lo">
                                                            <div style="margin-bottom: 2px;">
                                                                <t t-esc="counter"/>. <t t-esc="lo.name"/>
                                                                <t t-if="lo.father_name">
                                                                    &#160;पिता&#160;<t t-esc="lo.father_name"/>
                                                                </t>
                                                                <t t-elif="lo.spouse_name">
                                                                    &#160;पति&#160;<t t-esc="lo.spouse_name"/>
                                                                </t>
                                                            </div>
                                                            <t t-set="counter" t-value="counter + 1"/>
                                                        </t>
                                                    </t>
                                                    <span t-if="not (s.landowner_ids and len(s.landowner_ids) &gt; 0)" style="color:#dc3545;font-weight:bold">नहीं</span>
                                                </td>
                                                <td style="text-align:center"><span t-if="s.is_single_crop" style="color:#28a745;font-weight:bold">हाँ</span><span t-if="not s.is_single_crop" style="color:#dc3545;font-weight:bold">नहीं</span></td>
                                                <td style="text-align:center"><span t-if="s.is_double_crop" style="color:#28a745;font-weight:bold">हाँ</span><span t-if="not s.is_double_crop" style="color:#dc3545;font-weight:bold">नहीं</span></td>
                                                <td style="text-align:center"><span t-if="s.is_irrigated" style="color:#28a745;font-weight:bold">हाँ</span><span t-if="not s.is_irrigated" style="color:#dc3545;font-weight:bold">नहीं</span></td>
                                                <td style="text-align:center"><span t-if="s.is_unirrigated" style="color:#28a745;font-weight:bold">हाँ</span><span t-if="not s.is_unirrigated" style="color:#dc3545;font-weight:bold">नहीं</span></td>
                                                <td style="text-align:center; page-break-inside: avoid;">
                                                    <t t-if="s.tree_line_ids">
                                                        <t t-set="has_undeveloped" t-value="False"/>
                                                        <t t-foreach="s.tree_line_ids" t-as="tree_line">
                                                            <t t-if="tree_line.tree_type == 'non_fruit_bearing' and tree_line.development_stage == 'undeveloped'">
                                                                <t t-set="has_undeveloped" t-value="True"/>
                                                                <div style="margin-bottom: 2px;">
                                                                    <t t-esc="tree_line.tree_master_id.name if tree_line.tree_master_id else ''"/> - <t t-esc="tree_line.quantity or 0"/>
                                                                </div>
                                                            </t>
                                                        </t>
                                                        <span t-if="not has_undeveloped" style="color:#dc3545;font-weight:bold">नहीं</span>
                                                    </t>
                                                    <span t-if="not s.tree_line_ids" style="color:#dc3545;font-weight:bold">नहीं</span>
                                                </td>
                                                <td style="text-align:center; page-break-inside: avoid;">
                                                    <t t-if="s.tree_line_ids">
                                                        <t t-set="has_semi_developed" t-value="False"/>
                                                        <t t-foreach="s.tree_line_ids" t-as="tree_line">
                                                            <t t-if="tree_line.tree_type == 'non_fruit_bearing' and tree_line.development_stage == 'semi_developed'">
                                                                <t t-set="has_semi_developed" t-value="True"/>
                                                                <div style="margin-bottom: 2px;">
                                                                    <t t-esc="tree_line.tree_master_id.name if tree_line.tree_master_id else ''"/> - <t t-esc="tree_line.quantity or 0"/>
                                                                </div>
                                                            </t>
                                                        </t>
                                                        <span t-if="not has_semi_developed" style="color:#dc3545;font-weight:bold">नहीं</span>
                                                    </t>
                                                    <span t-if="not s.tree_line_ids" style="color:#dc3545;font-weight:bold">नहीं</span>
                                                </td>
                                                <td style="text-align:center; page-break-inside: avoid;">
                                                    <t t-if="s.tree_line_ids">
                                                        <t t-set="has_fully_developed" t-value="False"/>
                                                        <t t-foreach="s.tree_line_ids" t-as="tree_line">
                                                            <t t-if="tree_line.tree_type == 'non_fruit_bearing' and tree_line.development_stage == 'fully_developed'">
                                                                <t t-set="has_fully_developed" t-value="True"/>
                                                                <div style="margin-bottom: 2px;">
                                                                    <t t-esc="tree_line.tree_master_id.name if tree_line.tree_master_id else ''"/> - <t t-esc="tree_line.quantity or 0"/>
                                                                </div>
                                                            </t>
                                                        </t>
                                                        <span t-if="not has_fully_developed" style="color:#dc3545;font-weight:bold">नहीं</span>
                                                    </t>
                                                    <span t-if="not s.tree_line_ids" style="color:#dc3545;font-weight:bold">नहीं</span>
                                                </td>
                                                <td style="text-align:center">
                                                    <span t-if="s.house_type">
                                                        <span t-esc="s.house_type"/> / <span t-esc="s.house_area"/> वर्गफुट
                                                    </span>
                                                    <span t-if="not s.house_type" style="color:#dc3545;font-weight:bold">नहीं</span>
                                                </td>
                                                <td style="text-align:center"><span t-if="s.shed_area"><span t-esc="s.shed_area"/> वर्गफुट</span><span t-if="not s.shed_area" style="color:#dc3545;font-weight:bold">नहीं</span></td>
                                                <td style="text-align:center">
                                                    <span t-if="s.has_well == 'yes' and s.well_type == 'kachcha'" style="color:#28a745;font-weight:bold">हाँ-कच्चा</span>
                                                    <span t-if="s.has_well == 'yes' and s.well_type == 'pakka'" style="color:#28a745;font-weight:bold">हाँ-पक्का</span>
                                                    <span t-if="s.has_well != 'yes'" style="color:#dc3545;font-weight:bold">नहीं</span>
                                                </td>
                                                <td style="text-align:center"><span t-if="s.has_tubewell == 'yes'" style="color:#28a745;font-weight:bold">हाँ</span><span t-if="s.has_tubewell != 'yes'" style="color:#dc3545;font-weight:bold">नहीं</span></td>
                                                <td style="text-align:center"><span t-if="s.has_pond == 'yes'" style="color:#28a745;font-weight:bold">हाँ</span><span t-if="s.has_pond != 'yes'" style="color:#dc3545;font-weight:bold">नहीं</span></td>
                                                <td style="page-break-inside: avoid;">
                                                    <t t-set="has_remarks" t-value="False"/>
                                                    <t t-if="s.has_traded_land == 'yes'">
                                                        <t t-set="has_remarks" t-value="True"/>
                                                        <div style="margin-bottom: 2px;">
                                                            व्यपवर्तित-<t t-esc="s.traded_land_area or 0.0"/> हेक्टेयर
                                                        </div>
                                                    </t>
                                                    <t t-if="s.crop_type_id and (s.crop_type_id.code == 'FALLOW' or 'पड़ती' in (s.crop_type_id.name or ''))">
                                                        <t t-set="has_remarks" t-value="True"/>
                                                        <div style="margin-bottom: 2px;">पड़ती भूमि</div>
                                                    </t>
                                                    <t t-if="s.remarks">
                                                        <t t-set="has_remarks" t-value="True"/>
                                                        <div style="margin-bottom: 2px;"><t t-esc="s.remarks"/></div>
                                                    </t>
                                                    <span t-if="not has_remarks" style="color:#dc3545;font-weight:bold">नहीं</span>
                                                </td>
                                            </tr>
                                </t>
                            </tbody>
                            <tfoot>
                                <tr>
                                    <td colspan="18" style="border: 2px solid #000; padding: 8px; text-align: left; font-size: 16px; font-weight: 700;">
                                        <strong>संलग्न :- प्रभावित भूमियों का बी-1, खसरा एवं नक्शा</strong>
                                    </td>
                                </tr>
                            </tfoot>
                        </table>
                    </div>
                </div>
            </t>
        </t>
    </template>
</odoo>


