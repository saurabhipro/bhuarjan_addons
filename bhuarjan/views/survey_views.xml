<?xml version="1.0" encoding="utf-8"?>
<odoo>
    <!-- Survey List View -->
    <record id="view_bhu_survey_list" model="ir.ui.view">
        <field name="name">bhu.survey.list</field>
        <field name="model">bhu.survey</field>
        <field name="arch" type="xml">
            <list duplicate="0" string="Surveys / सर्वे" decoration-info="state == 'draft'" decoration-warning="state == 'submitted'" decoration-success="state == 'approved'" decoration-danger="state == 'rejected'" multi_edit="1" delete="1" default_order="create_date desc" create="not groups='bhuarjan.group_bhuarjan_collector'">
                <field name="name"/>
                <field name="user_id"/>
                <field name="project_id"/>
                <field name="village_id"/>
                <field name="tehsil_id"/>
                <field name="khasra_number"/>
                <field name="total_area"/>
                <field name="acquired_area"/>
                <field name="landowner_count" string="Landowners"/>
                <field name="survey_date"/>
                <field name="pending_since" string="Pending Since" invisible="state != 'submitted'"/>
                <field name="pending_with" string="Pending With / लंबित" invisible="state == 'approved' or state == 'rejected'"/>
                <field name="state" widget="badge" 
                       decoration-success="state == 'approved'"
                       decoration-info="state == 'draft'"
                       decoration-warning="state == 'submitted'"
                       decoration-danger="state == 'rejected'"/>
                <field name="is_notification_4_generated" widget="boolean_toggle" readonly="1"/>
                
            </list>
        </field>
    </record>

    <!-- Survey Form View -->
    <record id="view_bhu_survey_form" model="ir.ui.view">
        <field name="name">bhu.survey.form</field>
        <field name="model">bhu.survey</field>
        <field name="arch" type="xml">
            <form string="Survey / सर्वे" duplicate="0" js_class="confirm_save_form" create="not groups='bhuarjan.group_bhuarjan_collector'" edit="not groups='bhuarjan.group_bhuarjan_collector'">
                <header>
                    <button name="action_submit" string="Submit / प्रस्तुत करें" type="object" class="btn-primary" invisible="state != 'draft'" groups="!bhuarjan.group_bhuarjan_collector" confirm="Are you sure you want to submit this survey?"/>
                    <!-- Approve/Reject buttons: Only Department User and Admin can approve/reject surveys -->
                    <button name="action_approve" string="Approve / अनुमोदित करें" type="object" class="btn-success" invisible="state != 'submitted'" groups="bhuarjan.group_bhuarjan_department_user,bhuarjan.group_bhuarjan_admin"/>
                    <button name="action_reject" string="Reject / अस्वीकृत करें" type="object" class="btn-danger" invisible="state != 'submitted'" groups="bhuarjan.group_bhuarjan_department_user,bhuarjan.group_bhuarjan_admin"/>
                    <button name="action_reset_to_submitted" string="Reset to Submitted / प्रस्तुत में रीसेट" type="object" invisible="state != 'rejected'" groups="bhuarjan.group_bhuarjan_department_user,bhuarjan.group_bhuarjan_admin"/>
                    <field name="state" widget="statusbar" statusbar_visible="draft,submitted,approved,rejected"/>
                    <field name="is_notification_4_generated" widget="boolean_toggle" readonly="1" string="Is Noti 4 Generated / अधिसूचना 4 जेनरेट"/>
                </header>
                <sheet>
                    <!-- <div class="oe_title" style="margin-bottom: 10px;">
                        <h1 style="margin-bottom: 5px;">
                            <field name="name" placeholder="Survey Number / सर्वे नंबर" required="1" invisible="1"/>
                        </h1>
                    </div>
                     -->
                    <!-- Notification 4 Generated Warning -->
                    <div class="alert alert-info" role="alert" invisible="not is_notification_4_generated" style="margin-bottom: 15px;">
                        <strong>Notification 4 Generated / अधिसूचना 4 जेनरेट:</strong> This survey has been used to generate Notification 4. No further modifications are allowed.
                        <br/>
                        <strong>अधिसूचना 4 जेनरेट:</strong> इस सर्वे का उपयोग अधिसूचना 4 जेनरेट करने के लिए किया गया है। कोई और संशोधन की अनुमति नहीं है।
                    </div>
                    
                    <group>
                        <field name="pending_with" string="Pending With / लंबित" readonly="1" invisible="state == 'approved' or state == 'rejected'"/>
                    </group>
                    <group>
                        <group string="Project Information / परियोजना की जानकारी" class="survey-icon-project">
                            <field name="project_id" widget="selection" readonly="is_notification_4_generated or state == 'submitted' or is_collector_readonly" required="1" string="Project * / परियोजना *" options="{'no_create': True}"/>
                            <field name="department_id" widget="selection" readonly="is_notification_4_generated or state == 'submitted' or is_collector_readonly" required="1" string="Department * / विभाग *"/>
                            <field name="survey_date" widget="date" readonly="is_notification_4_generated or state == 'submitted' or is_collector_readonly" required="1" string="Survey Date * / सर्वे दिनाँक *" options="{'date_format': 'dd/mm/yyyy'}"/>
                        </group>
                        <group string="Location Information / स्थान की जानकारी" class="survey-icon-location">
                            <field name="company_id" readonly="is_notification_4_generated or state == 'submitted' or is_collector_readonly" required="1" string="District"/>
                            <field name="village_id" widget="selection" readonly="is_notification_4_generated or state == 'submitted' or is_collector_readonly" required="1" string="Village * / ग्राम का नाम *"/>
                            <field name="tehsil_id" widget="selection" readonly="is_notification_4_generated or state == 'submitted' or is_collector_readonly" required="1" string="Tehsil * / तहसील *"/>
                            <field name="district_name" readonly="is_notification_4_generated or state == 'submitted' or is_collector_readonly"/>
                            <field name="user_id" readonly="is_collector_readonly"/>
                            <field name="is_collector_readonly" invisible="1"/>
                        </group>
                    </group>
                    
                    <field name="survey_uuid" readonly="1" invisible="1"/>
                    
                    <notebook>
                        <page string="Survey / सर्वे" name="survey_details">
                            <group>
                                <group string="Land Information / भूमि की जानकारी" class="survey-icon-land">
                                    <field name="khasra_number" widget="char" readonly="is_notification_4_generated or state == 'submitted' or is_collector_readonly" required="1" string="Khasra Number * / खसरा नंबर *"/>
                                    <field name="total_area" widget="float" readonly="is_notification_4_generated or state == 'submitted' or is_collector_readonly"/>
                                    <field name="acquired_area" widget="float" readonly="is_notification_4_generated or state == 'submitted' or is_collector_readonly" string="Acquired Area (Hectares) / अर्जन हेतु प्रस्तावित क्षेत्रफल (हेक्टेयर)"/>
                                    <field name="has_traded_land" widget="radio" readonly="is_notification_4_generated or state == 'submitted' or is_collector_readonly" options="{'horizontal': true}"/>
                                    <field name="traded_land_area" widget="float" readonly="is_notification_4_generated or state == 'submitted' or is_collector_readonly" 
                                           invisible="has_traded_land != 'yes'" required="has_traded_land == 'yes'"/>
                                </group>
                                <group string="Crop Information / फसल की जानकारी" class="survey-icon-crop">
                                    <field name="crop_type_id" widget="selection" readonly="is_notification_4_generated or state == 'submitted' or is_collector_readonly" options="{'no_create_edit': True}" string="Crop Type / फसल का प्रकार"/>
                                    <field name="irrigation_type" widget="radio" readonly="is_notification_4_generated or state == 'submitted' or is_collector_readonly" options="{'horizontal': true}"/>
                                </group>
                            </group>
                            
                            <group>
                                <group string="House Information / घर की जानकारी" class="survey-icon-house">
                                    <field name="has_house" widget="radio" readonly="is_notification_4_generated or state == 'submitted' or is_collector_readonly" options="{'horizontal': true}"/>
                                    <field name="house_type" widget="selection" invisible="has_house != 'yes'" required="has_house == 'yes'" readonly="is_notification_4_generated or state == 'submitted' or is_collector_readonly"/>
                                    <field name="house_area" widget="float" invisible="has_house != 'yes'" required="has_house == 'yes'" readonly="is_notification_4_generated or state == 'submitted' or is_collector_readonly"/>
                                    <field name="has_shed" widget="radio" readonly="is_notification_4_generated or state == 'submitted' or is_collector_readonly" options="{'horizontal': true}"/>
                                    <field name="shed_area" widget="float" invisible="has_shed != 'yes'" required="has_shed == 'yes'" readonly="is_notification_4_generated or state == 'submitted' or is_collector_readonly"/>
                                </group>
                            </group>
                            
                            <group>
                                <group string="Infrastructure / बुनियादी सुविधाएं" class="survey-icon-infrastructure">
                                    <field name="has_well" widget="radio" readonly="is_notification_4_generated or state == 'submitted' or is_collector_readonly" options="{'horizontal': true}"/>
                                    <field name="well_type" widget="selection" invisible="has_well != 'yes'" readonly="is_notification_4_generated or state == 'submitted' or is_collector_readonly"/>
                                    <field name="well_count" invisible="has_well != 'yes'" readonly="is_notification_4_generated or state == 'submitted' or is_collector_readonly"/>
                                    <field name="has_tubewell" widget="radio" readonly="is_notification_4_generated or state == 'submitted' or is_collector_readonly" options="{'horizontal': true}"/>
                                    <field name="tubewell_count" invisible="has_tubewell != 'yes'" readonly="is_notification_4_generated or state == 'submitted' or is_collector_readonly"/>
                                    <field name="has_pond" widget="radio" readonly="is_notification_4_generated or state == 'submitted' or is_collector_readonly" options="{'horizontal': true}"/>
                                </group>
                                <group string="Remarks / टिप्पणी" class="survey-icon-remarks">
                                    <field name="remarks" placeholder="Enter any additional notes" readonly="is_collector_readonly"/>
                                </group>
                            </group>
                            
                        </page>
                        
                        <page string="Landowner / भूमिस्वामी" name="landowners_details">
                            <group string="Landowners / भूमिस्वामी" class="survey-icon-landowners" style="margin-top: 10px;">
                                <field name="landowner_ids" widget="many2many_tags" options="{'no_create': False, 'no_create_edit': False}" 
                                       context="{'default_company_id': company_id, 'default_village_id': village_id, 'default_tehsil_id': tehsil_id}"
                                       readonly="is_collector_readonly"/>
                            </group>
                            
                            <group string="Landowner Details / भूमिस्वामी विवरण" style="margin-top: 20px;">
                                <field name="landowner_ids" readonly="1">
                                    <list string="Landowner Details / भूमिस्वामी विवरण">
                                        <field name="name" string="Name / नाम"/>
                                        <field name="father_name" string="Father's Name / पिता का नाम"/>
                                        <field name="spouse_name" string="Spouse's Name / पति/पत्नी का नाम"/>
                                        <field name="village_id" string="Village / ग्राम"/>
                                        <field name="tehsil_id" string="Tehsil / तहसील"/>
                                        <field name="district_id" string="District / जिला"/>
                                        <field name="aadhar_number" string="Aadhar / आधार"/>
                                        <field name="pan_number" string="PAN / पैन"/>
                                        <field name="bank_name" string="Bank / बैंक"/>
                                        <field name="account_number" string="Account / खाता"/>
                                    </list>
                                </field>
                            </group>
                        </page>
                        
                        <page string="Tree Details / वृक्ष विवरण" name="tree_details">
                            <group string="Trees / वृक्ष">
                                <field name="tree_line_ids" readonly="is_notification_4_generated or state == 'submitted' or is_collector_readonly" nolabel="1" 
                                       context="{'default_development_stage': 'undeveloped'}">
                                        <list string="Trees / वृक्ष" editable="bottom">
                                            <field name="tree_master_id" options="{'no_create_edit': True}" required="1" string="Tree / वृक्ष" width="250"/>
                                            <field name="tree_type" string="Tree Type / वृक्ष प्रकार" width="200" readonly="1"/>
                                            <field name="development_stage" string="Development Stage / विकास स्तर" width="200"/>
                                            <field name="girth_cm" string="Girth (cm) / छाती (से.मी.)" width="150" 
                                                invisible="tree_type == 'fruit_bearing'"/>
                                            <field name="quantity" required="1" string="Quantity / मात्रा" width="200"/>
                                        </list>
                                </field>
                            </group>
                        </page>
                        
                        <page string="Photos / फोटो" name="survey_photos">
                            <group string="Survey Photos / सर्वे फोटो">
                                <field name="photo_ids" readonly="is_notification_4_generated or state == 'submitted' or is_collector_readonly" nolabel="1"/>
                            </group>
                        </page>
                    </notebook>
                    
                    <!-- Chatter removed -->
                </sheet>
                <chatter groups="bhuarjan.group_bhuarjan_ri,bhuarjan.group_bhuarjan_nayab_tahsildar,bhuarjan.group_bhuarjan_tahsildar,bhuarjan.group_bhuarjan_sdm,bhuarjan.group_bhuarjan_additional_collector,bhuarjan.group_bhuarjan_collector,bhuarjan.group_bhuarjan_admin"/>
            </form>
        </field>
    </record>

    <!-- Survey Search View -->
    <record id="view_bhu_survey_search" model="ir.ui.view">
        <field name="name">bhu.survey.search</field>
        <field name="model">bhu.survey</field>
        <field name="arch" type="xml">
            <search string="Search Surveys / सर्वे खोजें">
                <field name="name"/>
                <field name="landowner_ids"/>
                <field name="project_id"/>
                <field name="department_id"/>
                <field name="village_id"/>
                <field name="tehsil_id"/>
                <field name="khasra_number"/>
                <field name="survey_date"/>
                <field name="survey_uuid"/>
                
                <field name="landowner_pan_numbers" string="Pan Number"/>
                <field name="landowner_aadhar_numbers" string="Aadhar Number"/>
            
                <filter string="Draft / प्रारूप" name="draft" domain="[('state', '=', 'draft')]"/>
                <filter string="Submitted / प्रस्तुत" name="submitted" domain="[('state', '=', 'submitted')]"/>
                <filter string="Approved / अनुमोदित" name="approved" domain="[('state', '=', 'approved')]"/>
                <filter string="Rejected / अस्वीकृत" name="rejected" domain="[('state', '=', 'rejected')]"/>
                
                <separator/>
                <filter string="This Month / इस महीने" name="this_month" domain="[('survey_date', '>=', (context_today() - relativedelta(months=1)).strftime('%Y-%m-01')), ('survey_date', '&lt;', (context_today() + relativedelta(months=1)).strftime('%Y-%m-01'))]"/>
                <filter string="This Year / इस साल" name="this_year" domain="[('survey_date', '>=', context_today().strftime('%Y-01-01')), ('survey_date', '&lt;', (context_today() + relativedelta(years=1)).strftime('%Y-01-01'))]"/>
                
                <group expand="0" string="Group By / समूह बनाएं">
                    <filter string="State / स्थिति" name="group_state" context="{'group_by': 'state'}"/>
                    <filter string="Village / ग्राम" name="group_village" context="{'group_by': 'village_id'}"/>
                    <filter string="Tehsil / तहसील" name="group_tehsil" context="{'group_by': 'tehsil_id'}"/>
                    <filter string="Khasra Number / खसरा नंबर" name="group_khasra" context="{'group_by': 'khasra_number'}"/>
                    <filter string="Project / परियोजना" name="group_project" context="{'group_by': 'project_id'}"/>
                    <filter string="Department / विभाग" name="group_department" context="{'group_by': 'department_id'}"/>
                    <filter string="Survey Date / सर्वे दिनाँक" name="group_survey_date" context="{'group_by': 'survey_date'}"/>
                </group>
            </search>
        </field>
    </record>

    <!-- Survey Action -->
    <record id="action_bhu_survey" model="ir.actions.act_window">
        <field name="name">Surveys / सर्वे</field>
        <field name="res_model">bhu.survey</field>
        <field name="view_mode">kanban,list,form</field>
        <field name="search_view_id" ref="view_bhu_survey_search"/>
        <field name="context">{'create_name': 'नया सर्वे'}</field>
        <field name="help" type="html">
            <p class="o_view_nocontent_smiling_face">
                Create your first Survey!
            </p>
            <p>
                Survey is used for preliminary land acquisition surveys.
                You can add multiple citizens/landowners in one survey.
            </p>
        </field>
    </record>

    <!-- Bulk Approval Server Action -->
    <record id="action_survey_bulk_approval" model="ir.actions.server">
        <field name="name">Bulk Approval / बल्क अनुमोदन</field>
        <field name="model_id" ref="model_bhu_survey"/>
        <field name="binding_model_id" ref="model_bhu_survey"/>
        <field name="binding_view_types">list</field>
        <field name="state">code</field>
        <field name="code">
action = env['ir.actions.act_window']._for_xml_id('bhuarjan.action_survey_bulk_approval_wizard')
        </field>
    </record>


    <!-- Survey Kanban View -->
    <record id="view_bhu_survey_kanban" model="ir.ui.view">
        <field name="name">bhu.survey.kanban</field>
        <field name="model">bhu.survey</field>
        <field name="arch" type="xml">
            <kanban default_group_by="state" class="o_kanban_small_column" create="not groups='bhuarjan.group_bhuarjan_collector'">
                <field name="id"/>
                <field name="name"/>
                <field name="state"/>
                <field name="project_id"/>
                <field name="village_id"/>
                <field name="khasra_number"/>
                <field name="survey_date"/>
                <field name="user_id"/>
                <field name="is_notification_4_generated"/>
                <progressbar field="state" colors='{"draft": "info", "submitted": "warning", "approved": "success", "rejected": "danger"}'/>
                <templates>
                    <t t-name="kanban-box">
                        <div class="oe_kanban_card oe_kanban_global_click">
                            <div class="oe_kanban_content">
                                <div class="o_kanban_record_top">
                                    <div class="o_kanban_record_headings">
                                        <strong class="o_kanban_record_title">
                                            <field name="name"/>
                                        </strong>
                                    </div>
                                    <div class="o_kanban_record_top_right">
                                        <field name="state" widget="statusbar" statusbar_visible="draft,submitted,approved,rejected"/>
                                    </div>
                                </div>
                                <div class="o_kanban_record_body">
                                    <div class="row">
                                        <div class="col-6">
                                            <div><strong>Project:</strong> <field name="project_id"/></div>
                                            <div><strong>Village:</strong> <field name="village_id"/></div>
                                            <div><strong>Khasra:</strong> <field name="khasra_number"/></div>
                                        </div>
                                        <div class="col-6">
                                            <div><strong>Survey Date:</strong> <field name="survey_date"/></div>
                                            <div><strong>User:</strong> <field name="user_id"/></div>
                                            <div t-if="is_notification_4_generated">
                                                <span class="badge badge-info">Notification 4 Generated</span>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </t>
                </templates>
            </kanban>
        </field>
    </record>

    <!-- Survey Tree Line Views -->
    <record id="view_bhu_survey_tree_line_tree" model="ir.ui.view">
        <field name="name">bhu.survey.tree.line.tree</field>
        <field name="model">bhu.survey.tree.line</field>
        <field name="arch" type="xml">
            <list string="Tree Details / वृक्ष विवरण">
                <field name="tree_master_id" string="Tree / वृक्ष"/>
                <field name="tree_type" string="Tree Type / वृक्ष प्रकार"/>
                <field name="development_stage" string="Development Stage / विकास स्तर"/>
                <field name="girth_cm" string="Girth (cm) / छाती (से.मी.)" invisible="tree_type == 'fruit_bearing'"/>
                <field name="quantity" string="Quantity / मात्रा"/>
            </list>
        </field>
    </record>

    <!-- Survey Photo Views -->
    <record id="view_bhu_survey_photo_list" model="ir.ui.view">
        <field name="name">bhu.survey.photo.list</field>
        <field name="model">bhu.survey.photo</field>
        <field name="arch" type="xml">
            <list string="Survey Photos / सर्वे फोटो">
                <field name="display_name" string="Name / नाम"/>
                <field name="photo_type_id" string="Photo Type / फोटो प्रकार"/>
                <field name="filename" string="Filename / फ़ाइल नाम"/>
                <field name="s3_filename_display" string="S3 File / S3 फ़ाइल"/>
                <field name="sequence"/>
            </list>
        </field>
    </record>

    <record id="view_bhu_survey_photo_form" model="ir.ui.view">
        <field name="name">bhu.survey.photo.form</field>
        <field name="model">bhu.survey.photo</field>
        <field name="arch" type="xml">
            <form string="Survey Photo / सर्वे फोटो">
                <sheet>
                    <group>
                        <field name="display_name" string="Name / नाम" readonly="1"/>
                        <field name="photo_type_id" string="Photo Type / फोटो प्रकार"/>
                        <field name="filename" string="Filename / फ़ाइल नाम"/>
                        <field name="s3_url" string="S3 URL / S3 यूआरएल"/>
                        <field name="s3_filename_display" string="S3 File / S3 फ़ाइल" readonly="1"/>
                        <field name="file_size" string="File Size (bytes) / फ़ाइल आकार"/>
                        <field name="sequence"/>
                        <field name="file_upload" string="Upload File / फ़ाइल अपलोड करें" widget="binary"/>
                    </group>
                </sheet>
            </form>
        </field>
    </record>

</odoo>