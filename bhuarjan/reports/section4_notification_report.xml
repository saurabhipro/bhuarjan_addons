<?xml version="1.0" encoding="UTF-8"?>
<odoo>
    <!-- Section 4 Notification Report -->
    <record id="action_report_section4_notification" model="ir.actions.report">
        <field name="name">Section 4 Notification / धारा 4 अधिसूचना</field>
        <field name="model">bhu.section4.notification.wizard</field>
        <field name="report_type">qweb-pdf</field>
        <field name="report_name">bhuarjan.section4_notification_report</field>
        <field name="report_file">bhuarjan.section4_notification_report</field>
        <field name="paperformat_id" ref="bhuarjan.bhuarjan_sia_paper_format"/>
        <field name="print_report_name">'Section4_Notification_' + ((object and object.project_id and object.project_id.name) or (docs and docs[0] and docs[0].project_id and docs[0].project_id.name) or 'All')</field>
    </record>

    <!-- Custom Layout header and footer -->
    <template id="section4_report_custom_layout">
        <div class="header-section" style="margin-bottom: 12px;">
            <style>
                /* Global Font Settings */
                body, .header-section, .header-info-table, h2, strong, span, td, th {
                    font-family: 'Noto Sans Devanagari', 'Mangal', 'Arial Unicode MS', 'DejaVu Sans', sans-serif !important;
                }
                
                .header-info-table { 
                    width: 100%; 
                    border-collapse: collapse; 
                    font-size: 14px; 
                    border: 2px solid #000; 
                    margin-bottom: 0; 
                }
                .header-info-table td { 
                    border: 1px solid #000; 
                    padding: 6px; 
                    vertical-align: middle;
                }
            </style>
            <h2 style="text-decoration: underline; margin: 0 0 12px 0; text-align: center; font-size: 28px; font-weight: bold;">
                <strong>प्ररूप-एक (नियम 11 देखिये)</strong>
            </h2>
            <h2 style="text-decoration: underline; margin: 0 0 12px 0; text-align: center; font-size: 18px; font-weight: bold;">
                <strong>कार्यालय कलेक्टर एवं पदेन उप सचिव, राजस्व एवं आपदा प्रबंधन विभाग</strong>
            </h2>
            <h2 style="text-decoration: underline; margin: 0 0 12px 0; text-align: center; font-size: 22px; font-weight: bold;">
                <strong>अधिसूचना</strong>
            </h2>

            <table class="header-info-table">
                <tr>
                    <td rowspan="3" style="width: 10%; padding: 0; text-align: center; vertical-align: middle;">
                        <!-- Logo - Left Header Box -->
                        <t t-set="base_url" t-value="request.env['ir.config_parameter'].sudo().get_param('web.base.url')"/>
                            <img t-att-src="base_url + '/bhuarjan/static/description/logo.png'"
                                height="65"
                                width="80"/>
                        </td>
                    <td style="width: 40%; font-size: 14px;">
                        <strong>परियोजना का नाम :</strong>
                        <span t-if="wizard and wizard.project_id" t-esc="wizard.project_id.name"/>
                        <span t-if="not wizard or not wizard.project_id">........................</span>
                    </td>
                    <td style="width: 40%; font-size: 14px;">
                        <strong>विभाग का नाम :</strong>
                        <t t-set="department_name" t-value="''"/>
                        <t t-if="wizard and wizard.project_id and wizard.village_id">
                            <t t-set="first_survey" t-value="wizard.env['bhu.survey'].search([('project_id', '=', wizard.project_id.id), ('village_id', '=', wizard.village_id.id)], limit=1)"/>
                            <t t-if="first_survey and first_survey.department_id">
                                <t t-set="department_name" t-value="first_survey.department_id.name"/>
                            </t>
                        </t>
                        <span t-esc="department_name if department_name else 'Public Works Department'"/>
                    </td>
                    <td rowspan="3" style="width: 10%; padding: 0; text-align: center; vertical-align: middle;">
                        <!-- QR Code - Right Header Box -->
                        <t t-if="wizard">
                            <t t-set="notification" t-value="wizard.env['bhu.section4.notification'].search([('project_id', '=', wizard.project_id.id), ('village_id', '=', wizard.village_id.id)], limit=1, order='create_date desc')"/>
                            <t t-if="notification">
                                <t t-set="qr_code_img" t-value="notification.get_qr_code_data()"/>
                                <t t-set="qr_download_url" t-value="'https://bhuarjan.com/bhuarjan/section4/' + str(notification.notification_uuid or '') + '/download'"/>
                                <t t-if="qr_code_img">
                                    <a t-att-href="qr_download_url" style="display: block; width: 100%; margin: 0; padding: 0; text-decoration: none;">
                                        <img t-att-src="'data:image/png;base64,' + qr_code_img" 
                                             alt="QR Code - Click to download PDF" 
                                             style="width: 100%; max-width: 100%; height: auto; aspect-ratio: 1; border: none; display: block; margin: 0; padding: 0;"/>
                                    </a>
                                </t>
                                <t t-if="not qr_code_img">
                                    <a t-att-href="qr_download_url" style="display: block; width: 100%; margin: 0; padding: 0; text-decoration: none;">
                                        <div style="width: 100%; padding-top: 100%; position: relative; border: none; background: white; margin: 0;">
                                            <div style="position: absolute; top: 0; left: 0; width: 100%; height: 100%; display: flex; align-items: center; justify-content: center;">
                                                <div style="text-align: center; font-size: 7px;">
                                                    <div style="font-weight: bold;">QR Code</div>
                                                </div>
                                            </div>
                                        </div>
                                    </a>
                                </t>
                            </t>
                            <t t-if="not notification">
                                <div style="width: 100%; padding-top: 100%; position: relative; border: none; background: white; margin: 0;">
                                    <div style="position: absolute; top: 0; left: 0; width: 100%; height: 100%; display: flex; align-items: center; justify-content: center;">
                                        <div style="text-align: center; font-size: 7px;">
                                            <div style="font-weight: bold;">QR Code</div>
                                        </div>
                                    </div>
                                </div>
                            </t>
                        </t>
                    </td>
                </tr>
                <tr>
                    <td style="width: 40%; font-size: 14px;">
                        <strong>ग्राम का नाम :</strong>
                        <span t-if="wizard and wizard.village_id">
                            <t t-esc="wizard.village_id.name"/>
                        </span>
                        <span t-if="not wizard or not wizard.village_id">........................</span>
                    </td>
                    <td style="width: 40%; font-size: 14px;">
                        <strong>तहसील का नाम :</strong>
                        <span t-if="wizard and wizard.village_id">
                            <t t-esc="wizard.village_id.tehsil_id.name if wizard.village_id and wizard.village_id.tehsil_id else ''"/>
                            <t t-if="wizard.village_id and wizard.village_id.district_id"> जिला-<t t-esc="wizard.village_id.district_id.name"/> (छ.ग.)</t>
                        </span>
                        <span t-if="not wizard or not wizard.village_id">रायगढ़ जिला-रायगढ़ (छ.ग.)</span>
                    </td>
                </tr>
                <tr>
                    <td style="width: 40%; font-size: 14px;">
                        <strong>सर्वे दिनाँक :</strong>
                        <t t-set="survey_date" t-value="''"/>
                        <t t-if="wizard and wizard.project_id and wizard.village_id">
                            <t t-set="first_survey" t-value="wizard.env['bhu.survey'].search([('project_id', '=', wizard.project_id.id), ('village_id', '=', wizard.village_id.id)], limit=1, order='survey_date desc')"/>
                            <t t-if="first_survey and first_survey.survey_date">
                                <t t-set="survey_date" t-value="first_survey.survey_date.strftime('%d/%m/%Y')"/>
                            </t>
                        </t>
                        <span t-esc="survey_date if survey_date else '........................'"/>
                    </td>
                    <td style="width: 40%; font-size: 14px;">
                        <!-- Empty cell -->
                    </td>
                </tr>
            </table>
        </div>
    </template>

    <!-- Section 4 Notification Report Template -->
    <template id="section4_notification_report">
        <t t-call="web.html_container">
            <meta charset="utf-8"/>
            <t t-set="wizard" t-value="object or (docs and docs[0]) or None"/>
            <t t-call="bhuarjan.section4_report_custom_layout"/>
            <style>
                /* Global Font Settings for Section 4 Notification Report */
                body, .page, div, p, span, td, th, h2, h3, strong, .content, .header-info-table, 
                .notification-table, .question-item, .question-label, .question-answer, 
                .intro-section, .hearing-info, .signature-label {
                    font-family: 'Noto Sans Devanagari', 'Mangal', 'Arial Unicode MS', 'DejaVu Sans', sans-serif !important;
                }
                
                /* Base font size */
                body {
                    font-size: 16px;
                }
                
                .content {
                    font-size: 16px;
                    line-height: 1.6;
                }
                .content p {
                    margin-bottom: 12px;
                    text-align: justify;
                    font-size: 16px;
                    line-height: 1.6;
                    word-wrap: break-word;
                    overflow-wrap: break-word;
                }
                .notification-table {
                    width: 100%;
                    border-collapse: collapse;
                    margin: 20px 0;
                    border: 2px solid #000;
                }
                .notification-table th,
                .notification-table td {
                    border: 1px solid #000;
                    padding: 6px 8px;
                    text-align: center;
                    font-size: 12px;
                    vertical-align: middle;
                }
                .notification-table th {
                    background-color: #f5f5f5;
                    font-weight: bold;
                    font-size: 13px;
                    padding: 7px 8px;
                }
                .notification-table td {
                    padding: 6px 8px;
                }
                .notification-table td:nth-child(5) {
                    text-align: left;
                    padding-left: 10px;
                }
                .questions-section {
                    margin-top: 20px;
                }
                .question-item {
                    margin-bottom: 15px;
                    padding: 0;
                    page-break-inside: avoid;
                }
                .question-label {
                    font-weight: bold;
                    font-size: 16px;
                    margin-bottom: 8px;
                    display: block;
                    text-align: left;
                }
                .question-answer {
                    margin-top: 5px;
                    margin-bottom: 15px;
                    margin-left: 0;
                    text-align: justify;
                    font-size: 16px;
                    line-height: 1.6;
                    padding: 0;
                }
                .section-divider {
                    border-top: 2px solid #000;
                    margin: 20px 0;
                    width: 100%;
                }
                .intro-section {
                    margin: 20px 0;
                    padding: 0;
                }
                .intro-section p {
                    margin-bottom: 12px;
                    text-align: justify;
                    font-size: 16px;
                    line-height: 1.6;
                }
                .hearing-info {
                    margin: 20px 0;
                    padding: 0;
                    font-size: 16px;
                    line-height: 1.6;
                }
                .hearing-info strong {
                    font-size: 16px;
                }
                .signature-block {
                    margin-top: 100px;
                    page-break-inside: avoid;
                }
                .signature-line {
                    border-top: 2px solid #000;
                    width: 300px;
                    margin: 0 auto;
                    display: block;
                }
                .signature-label {
                    font-weight: bold;
                    font-size: 20px;
                    text-align: center;
                    margin-top: 10px;
                    letter-spacing: 0.5px;
                }
                .footer-section {
                    margin-top: 80px;
                    padding-top: 20px;
                    border-top: 2px solid #000;
                }
            </style>
            
            <t t-if="wizard">
                <div class="content">
                    <div class="intro-section">
                        <p style="text-align: justify; margin-bottom: 12px; font-size: 16px; line-height: 1.6;">
                            भूमि अर्जन, पुनर्वासन एवं पुनर्व्यवस्थापन में उचित प्रतिकर तथा पारदर्शिता का अधिकार अधिनियम, 2013 की धारा 4 सहपठित नियम 7 के अंतर्गत
                        </p>
                        
                        <p style="text-align: justify; margin-bottom: 0; font-size: 16px; line-height: 1.6;">
                            नीचे अनुसूची में उल्लिखित भूमि का अर्जन लोक प्रयोजन हेतु राज्य सरकार द्वारा आशयित है, अर्थात् :-
                        </p>
                    </div>
                    
                    <table class="notification-table">
                        <thead>
                            <tr>
                                <th style="width: 10%;">जिला</th>
                                <th style="width: 15%;">तहसील</th>
                                <th style="width: 20%;">ग्राम/शहर</th>
                                <th style="width: 15%;">क्षेत्रफल (हेक्टेयर)</th>
                                <th style="width: 40%;">लोक प्रयोजन का विवरण</th>
                            </tr>
                        </thead>
                        <tbody>
                            <t t-set="consolidated_data" t-value="wizard._get_consolidated_village_data() if wizard else []"/>
                            <t t-set="public_purpose" t-value="wizard.public_purpose if wizard and wizard.public_purpose else (wizard.project_id.name if wizard and wizard.project_id else '')"/>
                            <t t-set="public_purpose_clean" t-value="wizard.get_plain_text_from_html(public_purpose) if wizard and public_purpose else (public_purpose if public_purpose else '')"/>
                            <t t-if="consolidated_data and len(consolidated_data) > 0">
                                <t t-foreach="consolidated_data" t-as="v_data">
                                    <tr>
                                        <td style="font-size: 12px;"><t t-esc="v_data.get('district', 'Raigarh (Chhattisgarh)')"/></td>
                                        <td style="font-size: 12px;"><t t-esc="v_data.get('tehsil', '')"/></td>
                                        <td style="font-size: 12px;"><t t-esc="v_data.get('village_name', '')"/></td>
                                        <td style="font-size: 12px;"><t t-esc="'{:.4f}'.format(v_data.get('total_area', 0.0))"/></td>
                                        <td style="font-size: 12px; text-align: left;"><t t-esc="public_purpose_clean"/></td>
                                    </tr>
                                </t>
                            </t>
                            <t t-if="not consolidated_data or len(consolidated_data) == 0">
                                <tr>
                                    <td colspan="5" style="text-align: center; padding: 20px; color: #999;">
                                        No survey data available for the selected villages.
                                    </td>
                                </tr>
                            </t>
                        </tbody>
                    </table>
                    
                    <div class="hearing-info">
                        <p style="text-align: justify; margin-bottom: 0; font-size: 16px; line-height: 1.6; word-wrap: break-word; overflow-wrap: break-word;">
                            उपरोक्त उल्लिखित भूमि के अर्जन हेतु सामाजिक समाघात निर्धारण के अध्ययन हेतु जन सुनवाई (दिनांक) 
                            <strong><t t-esc="wizard.get_formatted_hearing_date()"/></strong> को 
                            (समय) <strong><t t-esc="wizard.public_hearing_time or '........................'"/></strong> बजे 
                            (स्थान) <strong><t t-esc="wizard.public_hearing_place or '........................'"/></strong> पर तयत की गई है। 
                            प्रस्तावित भूमि अर्जन का अन्य विवरण निम्नानुसार है :-
                        </p>
                    </div>
                    
                    <div class="section-divider"></div>
                    
                    <div class="questions-section">
                        <div class="question-item">
                            <div class="question-label">(एक) लोक प्रयोजन का संक्षिप्त विवरण।</div>
                            <t t-if="wizard.q1_brief_description">
                                <div class="question-answer"><t t-raw="wizard.q1_brief_description"/></div>
                            </t>
                            <t t-if="not wizard.q1_brief_description">
                                <div class="question-answer">........................</div>
                            </t>
                        </div>
                        
                        <div class="question-item">
                            <div class="question-label">(दो) प्रत्यक्ष रूप से प्रभावित परिवारों की संख्या।</div>
                            <div class="question-answer"><t t-esc="wizard.q2_directly_affected or '........................'"/></div>
                        </div>
                        
                        <div class="question-item">
                            <div class="question-label">(तीन) अप्रत्यक्ष रूप से प्रभावित परिवारों की संख्या।</div>
                            <div class="question-answer"><t t-esc="wizard.q3_indirectly_affected or '........................'"/></div>
                        </div>
                        
                        <div class="question-item">
                            <div class="question-label">(चार) प्रभावित क्षेत्र में निजी मकानों तथा अन्य परिसंपत्तियों की अनुमानित संख्या।</div>
                            <div class="question-answer"><t t-esc="wizard.q4_private_assets or '........................'"/></div>
                        </div>
                        
                        <div class="question-item">
                            <div class="question-label">(पाँच) प्रभावित क्षेत्र में शासकीय मकान तथा अन्य परिसंपत्तियों की अनुमानित संख्या।</div>
                            <div class="question-answer"><t t-esc="wizard.q5_government_assets or '........................'"/></div>
                        </div>
                        
                        <div class="question-item">
                            <div class="question-label">(छः) क्या प्रस्तावित अर्जन न्यूनतम है ?</div>
                            <div class="question-answer"><t t-esc="wizard.q6_minimal_acquisition or '........................'"/></div>
                        </div>
                        
                        <div class="question-item">
                            <div class="question-label">(सात) क्या संभव विकल्पों और इसकी साध्यता पर विचार कर लिया गया है ?</div>
                            <t t-if="wizard.q7_alternatives_considered">
                                <div class="question-answer"><t t-raw="wizard.q7_alternatives_considered"/></div>
                            </t>
                            <t t-if="not wizard.q7_alternatives_considered">
                                <div class="question-answer">........................</div>
                            </t>
                        </div>
                        
                        <div class="question-item">
                            <div class="question-label">(आठ) परियोजना की कुल लागत।</div>
                            <div class="question-answer"><t t-esc="wizard.q8_total_cost or '........................'"/></div>
                        </div>
                        
                        <div class="question-item">
                            <div class="question-label">(नौ) परियोजना से होने वाला लाभ।</div>
                            <t t-if="wizard.q9_project_benefits">
                                <div class="question-answer"><t t-raw="wizard.q9_project_benefits"/></div>
                            </t>
                            <t t-if="not wizard.q9_project_benefits">
                                <div class="question-answer">........................</div>
                            </t>
                        </div>
                        
                        <div class="question-item">
                            <div class="question-label">(दस) प्रस्तावित सामाजिक समाघात की प्रतिपूर्ति के लिये उपाय तथा उस पर होने वाला संभावित व्यय।</div>
                            <t t-if="wizard.q10_compensation_measures">
                                <div class="question-answer"><t t-raw="wizard.q10_compensation_measures"/></div>
                            </t>
                            <t t-if="not wizard.q10_compensation_measures">
                                <div class="question-answer">........................</div>
                            </t>
                        </div>
                        
                        <div class="question-item">
                            <div class="question-label">(ग्यारह) परियोजना द्वारा प्रभावित होने वाले अन्य घटक।</div>
                            <t t-if="wizard.q11_other_components">
                                <div class="question-answer"><t t-raw="wizard.q11_other_components"/></div>
                            </t>
                            <t t-if="not wizard.q11_other_components">
                                <div class="question-answer">........................</div>
                            </t>
                        </div>
                    </div>
                    
                    <div class="section-divider"></div>
                    
                    <div class="intro-section" style="margin-top: 20px; margin-bottom: 40px;">
                        <p style="text-align: justify; margin-bottom: 0; font-size: 16px; line-height: 1.6;">
                            उपरोक्त भूमि अर्जन के संबंध में किसी व्यक्ति/संस्था या अन्य किसी व्यक्ति को कोई जानकारी / सुझाव देना हो, तो विहित तिथि/समय एवं स्थान पर दी जा सकेगी।
                        </p>
                    </div>
                    
                    <div class="section-divider"></div>
                    
                    <div class="signature-block">
                        <div style="text-align: center; margin-top: 80px;">
                            <div class="signature-line"></div>
                            <p class="signature-label">जिला कलेक्टर</p>
                        </div>
                    </div>
                </div>
            </t>
        </t>
    </template>
</odoo>
